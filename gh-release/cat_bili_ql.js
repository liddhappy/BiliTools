"use strict";var t=require("path"),e=require("pako"),n=require("fs"),i=require("querystring"),a=require("nodemailer"),s=require("got"),o=require("tough-cookie"),r=require("tunnel"),c=require("crypto"),u=require("qs"),d=require("axios");function f(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}function l(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(n){if("default"!==n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}})),e.default=t,Object.freeze(e)}var p=l(t),g=l(e),h=l(n),m=l(i),_=l(a),y=l(s),w=l(o),v=l(r),$=l(c),T=f(d);function b(t){const e=t||S(),n=e.getFullYear(),i=e.getMonth()+1;return 2===i?n%4==0&&n%100!=0||n%400==0?29:28:[4,6,9,11].includes(i)?30:31}function S(){const t=new Date,e=t.getTime(),n=t.getTimezoneOffset()/60;return new Date(e+36e5*(n+8))}function I(t,e){return Math.ceil(e/t)}function O(t,e,n){if(n&&"boolean"!=typeof n&&(e=n=void 0),void 0===n&&("boolean"==typeof e?(n=e,e=void 0):"boolean"==typeof t&&(n=t,t=void 0)),void 0===t&&void 0===e?(t=0,e=1):void 0===e&&(e=t,t=0),t>e){const n=t;t=e,e=n}if(n||t%1||e%1){const n=Math.random();return Math.min(t+n*(e-t+parseFloat("1e-"+((n+"").length-1))),e)}return t+Math.floor(Math.random()*(e-t+1))}const E={value:""},C={log:x,error:function(t){x("error",t)},warn:function(t){x("warn",t)},info:function(t){x("info",t)},verbose:function(t){x("verbose",t)},debug:function(t){x("debug",t)}};function x(t,e){const n=S().toString().match(/\w{2}:\w{2}:\w{2}/)[0];if(function(t="debug"){const e=["error","warn","info","verbose","debug"],n=e.indexOf(t);return n>0?e.slice(0,n+1):e}().includes(t)){const t=`[${n}] ${e}`;E.value+=t+"\r\n"}console.log("[%s %s] %s",t,n,e)}const N=()=>"QingLong"===process.env.BARK_GROUP||"/ql"===process.env.QL_DIR;class A{static configFileName=function(){const t=N()?"cat_bili_config":"config",e=".json",{BILITOOLS_FILE_NAME:n}=process.env;return n?n.endsWith(e)?n:`${n}.json`:t+e}();static isQingLongPanel=N()}const P=t=>p.resolve(process.cwd(),t);function k(t){throw new Error(t||"é…ç½®æ–‡ä»¶ä¸å­˜ï¼ˆä½ç½®ä¸æ­£ç¡®ï¼‰åœ¨æˆ– cookie ä¸å­˜åœ¨ï¼ï¼ï¼")}const L=[()=>require(P("./config/config.dev.json")),()=>require(`./${A.configFileName}`),()=>require(P(`./config/${A.configFileName}`))],R=[()=>require("./config.json"),()=>require(P("./config/config.json"))],U=()=>{const{BILITOOLS_CONFIG:t,BILI_SCF_CONFIG:e,BILI_CONFIG:n}=process.env,i=t||e||n;if(i)try{return JSON.parse((t=>{try{const e=Buffer.from(t,"base64").toString("binary").split("").map((t=>t.charCodeAt(0))),n=g.inflate(new Uint8Array(e)),i=String.fromCharCode.apply(null,new Uint16Array(n));try{return unescape(i)}catch(t){return i}}catch(t){throw new Error("Error: å½“å‰å­—ç¬¦ä¸²ä¸èƒ½è¢«Gzipè§£å¯†")}})(i))}catch{k("ç¯å¢ƒä¸­çš„é…ç½®ä¸æ˜¯æœ‰æ•ˆçš„ JSON å­—ç¬¦ä¸²ï¼")}};function B(t){const e=t.account.filter((t=>t.cookie));if(0===e.length)return;if(A.isQingLongPanel)return function(t){const e=process.argv.find((t=>t.includes("--item")||t.includes("-i")||t.includes("-I")));if(!e)return t[0];const n=Number(e.split("=")[1])-1;return!n||n>=t.length||n<0?(C.warn("ä¼¼ä¹æƒ³è¦æŒ‡å®šä¸€ä¸ªä¸å­˜åœ¨çš„ç”¨æˆ·ï¼Œæˆ‘ä»¬å°†æŒ‡å®šç¬¬ä¸€ä¸ªç”¨æˆ·"),t[0]):t[n]}(e);C.warn("åœ¨å•ç”¨æˆ·åœºæ™¯ä¸‹é…ç½®äº†å¤šç”¨æˆ·ï¼Œæˆ‘ä»¬å°†æ”¾å¼ƒå¤šä½™çš„é…ç½®");const n=e[0];return n.message=Object.assign(t.message||{},n.message),n}const D=function(){let t,e=!1;A.isQingLongPanel&&L.splice(0,1,...R);for(const n of L)try{if(t=n(),t)break;e=!0}catch(t){const{message:n={}}=t;n.includes&&n.includes("in JSON at position")&&(e=!0);continue}if(t||(t=U()),t||(e&&k("é…ç½®æ–‡ä»¶å­˜åœ¨ï¼Œä½†æ˜¯æ— æ³•è§£æï¼å¯èƒ½ JSON æ ¼å¼ä¸æ­£ç¡®ï¼"),k()),t.account&&t.account.length){const e=B(t);if(e)return e}return t.cookie||k(),t}(),{cookie:G}=D;function M(t){return t?t.split("; ").map((t=>t.split("="))):[]}function H(t,e){return t?e&&0!==e.length?function(t){const e=Object.keys(t).reduce(((e,n)=>e+`${n}=${t[n]}; `),"");return e.substring(0,e.length-2||0)}(function(t,e){const n=M(null==e?void 0:e[0]).filter((t=>2===t.length)),i=M(t).concat(n).filter((t=>2===t.length)),a={};for(const t of i)a[t[0]]?a[t[0]]=t[1]:Object.defineProperty(a,t[0],{value:t[1],enumerable:!0,writable:!0});return a}(t,e)):t:""}function K(t,e){if(!t)return null;const n=`(?:^|)${e}=([^;]*)(?:;|$)`,i=t.match(n);return i?i[1]:null}function j(){return K(G,"bili_jct")||""}var q,J;function Y(t){return null==t?void 0:t.map((t=>Number(t)))}class Q{static config=D;static COOKIE=D.cookie;static BILIJCT=j();static NICKNAME="";static USERID=function(){return Number(K(G,"DedeUserID"))||0}();static USER_AGENT=D.userAgent;static BILI_TARGET_COINS=D.targetCoins??5;static biliApiDelay=D.apiDelay||[2,6];static BILI_API_DELAY=Array.isArray(Q.biliApiDelay)?Q.biliApiDelay:[Q.biliApiDelay];static BILI_CUSTOMIZE_UP=Y(D.customizeUp)||[];static BILI_GIFT_UP=Y(D.giftUp)||Q.BILI_CUSTOMIZE_UP||[];static BILI_TARGET_LEVEL=D.targetLevel??6;static BILI_STAY_COINS=D.stayCoins??0;static BILI_UPPER_ACC_MATCH=D.upperAccMatch||!0;static BILI_COIN_RETRY_NUM=D.coinRetryNum||4;static CHARGE_ID=D.chargeUpId||Q.USERID;static CHARGE_PRESET_TIME=D.chargePresetTime||31;static PUSHPLUS_TOKEN=process.env.PUSHPLUS_TOKEN||(null===(q=D.message)||void 0===q?void 0:q.pushplusToken);static MATCH_COINS=D.matchCoins??5;static MATCH_SELECTION=D.matchSelection??1;static MATCH_DIFF=D.matchDiff??0;static MESSAGE_API=null===(J=D.message)||void 0===J?void 0:J.api}class F{static money=0;static coinsTask=Q.BILI_TARGET_COINS;static share=!1;static watch=!1;static currentStartFun=0;static bCoinCouponBalance=0;static vipType=0}class X{static DAILY_TRIGGER_NAME="daily_bili_timer";static HEART_TRIGGER_NAME="heart_bili_timer";static DAILY_RUN_TIME="17:30:00-23:40:00";static HEART_RUN_TIME="12:00:00-20:00:00";static MS2DATE=864e5}!function(){var t;const e=(null===(t=Q.config)||void 0===t?void 0:t.message)||{};Q.PUSHPLUS_TOKEN&&(process.env.PUSH_PLUS_TOKEN=Q.PUSHPLUS_TOKEN),["GOBOT_URL","GOBOT_TOKEN","GOBOT_QQ","SCKEY","QQ_SKEY","QQ_MODE","BARK_PUSH","BARK_SOUND","BARK_GROUP","TG_BOT_TOKEN","TG_USER_ID","TG_PROXY_AUTH","TG_PROXY_HOST","TG_PROXY_PORT","TG_API_HOST","DD_BOT_TOKEN","DD_BOT_SECRET","QYWX_KEY","QYWX_AM","IGOT_PUSH_KEY","PUSH_PLUS_TOKEN","PUSH_PLUS_USER"].forEach((t=>{const n=e[(i=t,i.toLowerCase().replace(/_(\w)/g,((t,e)=>e.toUpperCase())))]||e[t]||process.env[t];var i;n&&(process.env[t]=n)}))}();const W=new function(t,e){return new class{constructor(t,e){this.name=t,this.data=null,this.dataFile="box.dat",this.logs=[],this.logSeparator="\n",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`ğŸ””${this.name}, å¼€å§‹!`)}isNode(){return"undefined"!=typeof module&&!!module.exports}isQuanX(){return"undefined"!=typeof $task}isSurge(){return"undefined"!=typeof $httpClient&&"undefined"==typeof $loon}isLoon(){return"undefined"!=typeof $loon}getScript(t){return new Promise((e=>{W.get({url:t},((t,n,i)=>e(i)))}))}runScript(t,e){return new Promise((n=>{let i=this.getdata("@chavy_boxjs_userCfgs.httpapi");i=i?i.replace(/\n/g,"").trim():i;let a=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");a=a?1*a:20,a=e&&e.timeout?e.timeout:a;const[s,o]=i.split("@"),r={url:`http://${o}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:a},headers:{"X-Key":s,Accept:"*/*"}};W.post(r,((t,e,i)=>n(i)))})).catch((t=>this.logErr(t)))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),n=this.fs.existsSync(t),i=!n&&this.fs.existsSync(e);if(!n&&!i)return{};{const i=n?t:e;try{return JSON.parse(this.fs.readFileSync(i))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),n=this.fs.existsSync(t),i=!n&&this.fs.existsSync(e),a=JSON.stringify(this.data);n?this.fs.writeFileSync(t,a):i?this.fs.writeFileSync(e,a):this.fs.writeFileSync(t,a)}}lodash_get(t,e,n){const i=e.replace(/\[(\d+)\]/g,".$1").split(".");let a=t;for(const t of i)if(a=Object(a)[t],void 0===a)return n;return a}lodash_set(t,e,n){return Object(t)!==t||(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce(((t,n,i)=>Object(t[n])===t[n]?t[n]:t[n]=Math.abs(e[i+1])>>0==+e[i+1]?[]:{}),t)[e[e.length-1]]=n),t}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,n,i]=/^@(.*?)\.(.*?)$/.exec(t),a=n?this.getval(n):"";if(a)try{const t=JSON.parse(a);e=t?this.lodash_get(t,i,""):e}catch(t){e=""}}return e}setdata(t,e){let n=!1;if(/^@/.test(e)){const[,i,a]=/^@(.*?)\.(.*?)$/.exec(e),s=this.getval(i),o=i?"null"===s?null:s||"{}":"{}";try{const e=JSON.parse(o);this.lodash_set(e,a,t),n=this.setval(JSON.stringify(e),i)}catch(e){const s={};this.lodash_set(s,a,t),n=this.setval(JSON.stringify(s),i)}}else n=W.setval(t,e);return n}getval(t){return this.isSurge()||this.isLoon()?$persistentStore.read(t):this.isQuanX()?$prefs.valueForKey(t):this.isNode()?(this.data=this.loaddata(),this.data[t]):this.data&&this.data[t]||null}setval(t,e){return this.isSurge()||this.isLoon()?$persistentStore.write(t,e):this.isQuanX()?$prefs.setValueForKey(t,e):this.isNode()?(this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0):this.data&&this.data[e]||null}initGotEnv(t){this.got=this.got?this.got:y,this.cktough=this.cktough?this.cktough:w,this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}get(t,e=(()=>{})){t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"]),this.isSurge()||this.isLoon()?$httpClient.get(t,((t,n,i)=>{!t&&n&&(n.body=i,n.statusCode=n.status),e(t,n,i)})):this.isQuanX()?$task.fetch(t).then((t=>{const{statusCode:n,statusCode:i,headers:a,body:s}=t;e(null,{status:n,statusCode:i,headers:a,body:s},s)}),(t=>e(t))):this.isNode()&&(this.initGotEnv(t),this.got(t).on("redirect",((t,e)=>{try{const n=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();this.ckjar.setCookieSync(n,null),e.cookieJar=this.ckjar}catch(t){this.logErr(t)}})).then((t=>{const{statusCode:n,statusCode:i,headers:a,body:s}=t;e(null,{status:n,statusCode:i,headers:a,body:s},s)}),(t=>e(t))))}post(t,e=(()=>{})){if(t.body&&t.headers&&!t.headers["Content-Type"]&&(t.headers["Content-Type"]="application/x-www-form-urlencoded"),delete t.headers["Content-Length"],this.isSurge()||this.isLoon())$httpClient.post(t,((t,n,i)=>{!t&&n&&(n.body=i,n.statusCode=n.status),e(t,n,i)}));else if(this.isQuanX())t.method="POST",$task.fetch(t).then((t=>{const{statusCode:n,statusCode:i,headers:a,body:s}=t;e(null,{status:n,statusCode:i,headers:a,body:s},s)}),(t=>e(t)));else if(this.isNode()){this.initGotEnv(t);const{url:n,...i}=t;this.got.post(n,i).then((t=>{const{statusCode:n,statusCode:i,headers:a,body:s}=t;e(null,{status:n,statusCode:i,headers:a,body:s},s)}),(t=>e(t)))}}time(t){const e={"M+":(new Date).getMonth()+1,"d+":(new Date).getDate(),"H+":(new Date).getHours(),"m+":(new Date).getMinutes(),"s+":(new Date).getSeconds(),"q+":Math.floor(((new Date).getMonth()+3)/3),S:(new Date).getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,((new Date).getFullYear()+"").substr(4-RegExp.$1.length)));for(const n in e)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[n]:("00"+e[n]).substr((""+e[n]).length)));return t}msg(e=t,n="",i="",a){const s=t=>!t||!this.isLoon()&&this.isSurge()?t:"string"==typeof t?this.isLoon()?t:this.isQuanX()?{"open-url":t}:void 0:"object"==typeof t&&(t["open-url"]||t["media-url"])?this.isLoon()?t["open-url"]:this.isQuanX()?t:void 0:void 0;W.isMute||(this.isSurge()||this.isLoon()?$notification.post(e,n,i,s(a)):this.isQuanX()&&$notify(e,n,i,s(a))),this.logs.push("","==============ğŸ“£ç³»ç»Ÿé€šçŸ¥ğŸ“£=============="),this.logs.push(e),n&&this.logs.push(n),i&&this.logs.push(i)}log(...t){t.length>0?this.logs=[...this.logs,...t]:C.info(this.logs.join(this.logSeparator))}logErr(t,e){!this.isSurge()&&!this.isQuanX()&&!this.isLoon()?W.log("",`â—ï¸${this.name}, é”™è¯¯!`,t.stack):W.log("",`â—ï¸${this.name}, é”™è¯¯!`,t)}wait(t){return new Promise((e=>setTimeout(e,t)))}done(t={}){const e=((new Date).getTime()-this.startTime)/1e3;this.log("",`ğŸ””${this.name}, ç»“æŸ! ğŸ•› ${e} ç§’`),this.log(),(this.isSurge()||this.isQuanX()||this.isLoon())&&$done(t)}}(t,e)};let z="",V="",Z="",tt="QingLong",et="",nt="",it="",at="",st="",ot="api.telegram.org",rt="",ct="",ut="",dt="",ft="",lt="",pt="";async function gt(t,e){var n;const i=null===(n=Q.config.message)||void 0===n?void 0:n.email;if(!(i&&i.pass&&i.from&&i.host))return;const a=Number(i.port)||465,s=_.createTransport({host:i.host,port:a,secure:465===a,auth:{user:i.from,pass:i.pass}}),o=await s.sendMail({from:`${t} <${i.from}>`,to:i.to,subject:t,headers:{"Content-Type":"text/plain; charset=utf-8"},text:e});C.info(`é‚®ä»¶æ¶ˆæ¯å·²å‘é€: ${o.messageId}`)}async function ht(t,e){try{const n=Q.MESSAGE_API;if(!n)return;const i=n.replace("{title}",t).replace("{text}",e);await W.get(i)}catch(t){}}function mt(t,e,n=2100){return new Promise((i=>{if(z){e=e.replace(/[\n\r]/g,"\n\n");const a={url:z.includes("SCT")?`https://sctapi.ftqq.com/${z}.send`:`https://sc.ftqq.com/${z}.send`,body:`text=${t}&desp=${e}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};setTimeout((()=>{W.post(a,((t,e,n)=>{try{t?(C.info("å‘é€é€šçŸ¥è°ƒç”¨APIå¤±è´¥ï¼ï¼\n"),C.info(t)):0===(n=JSON.parse(n)).errno||0===n.data.errno?C.info("serveré…±å‘é€é€šçŸ¥æ¶ˆæ¯æˆåŠŸğŸ‰\n"):1024===n.errno?C.info(`serveré…±å‘é€é€šçŸ¥æ¶ˆæ¯å¼‚å¸¸: ${n.errmsg}\n`):C.info(`serveré…±å‘é€é€šçŸ¥æ¶ˆæ¯å¼‚å¸¸\n${JSON.stringify(n)}`)}catch(t){W.logErr(t,e)}finally{i(n)}}))}),n)}else i("")}))}function _t(t,e,n={}){return new Promise((i=>{if(V){const a={url:`${V}/${encodeURIComponent(t)}/${encodeURIComponent(e)}?sound=${Z}&group=${tt}&${m.stringify(n)}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};W.get(a,((t,e,n)=>{try{t?(C.info("Bark APPå‘é€é€šçŸ¥è°ƒç”¨APIå¤±è´¥ï¼ï¼\n"),C.info(t)):200===(n=JSON.parse(n)).code?C.info("Bark APPå‘é€é€šçŸ¥æ¶ˆæ¯æˆåŠŸğŸ‰\n"):C.info(`${n.message}\n`)}catch(t){W.logErr(t,e)}finally{i("")}}))}else i("")}))}function yt(t,e){return new Promise((n=>{if(et&&nt){const i={url:`https://${ot}/bot${et}/sendMessage`,body:`chat_id=${nt}&text=${t}\n\n${e}&disable_web_page_preview=true`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};if(it&&at){const t={https:v.httpsOverHttp({proxy:{host:it,port:+at,proxyAuth:st}})};Object.assign(i,{agent:t})}W.post(i,((t,e,i)=>{try{t?(C.info("telegramå‘é€é€šçŸ¥æ¶ˆæ¯å¤±è´¥ï¼ï¼\n"),C.info(t)):(i=JSON.parse(i)).ok?C.info("Telegramå‘é€é€šçŸ¥æ¶ˆæ¯æˆåŠŸğŸ‰ã€‚\n"):400===i.error_code?C.info("è¯·ä¸»åŠ¨ç»™botå‘é€ä¸€æ¡æ¶ˆæ¯å¹¶æ£€æŸ¥æ¥æ”¶ç”¨æˆ·IDæ˜¯å¦æ­£ç¡®ã€‚\n"):401===i.error_code&&C.info("Telegram bot token å¡«å†™é”™è¯¯ã€‚\n")}catch(t){W.logErr(t,e)}finally{n(i)}}))}else n("")}))}function wt(t,e){return new Promise((n=>{const i={url:`https://oapi.dingtalk.com/robot/send?access_token=${rt}`,json:{msgtype:"text",text:{content:` ${t}\n\n${e}`}},headers:{"Content-Type":"application/json"},timeout:15e3};if(rt&&ct){const t=require("crypto"),e=Date.now(),a=t.createHmac("sha256",ct);a.update(`${e}\n${ct}`);const s=encodeURIComponent(a.digest("base64"));i.url=`${i.url}&timestamp=${e}&sign=${s}`,W.post(i,((t,e,i)=>{try{t?(C.info("é’‰é’‰å‘é€é€šçŸ¥æ¶ˆæ¯å¤±è´¥ï¼ï¼\n"),C.info(t)):0===(i=JSON.parse(i)).errcode?C.info("é’‰é’‰å‘é€é€šçŸ¥æ¶ˆæ¯æˆåŠŸğŸ‰ã€‚\n"):C.info(`${i.errmsg}\n`)}catch(t){W.logErr(t,e)}finally{n(i)}}))}else rt?W.post(i,((t,e,i)=>{try{t?(C.info("é’‰é’‰å‘é€é€šçŸ¥æ¶ˆæ¯å¤±è´¥ï¼ï¼\n"),C.info(t)):0===(i=JSON.parse(i)).errcode?C.info("é’‰é’‰å‘é€é€šçŸ¥æ¶ˆæ¯å®Œæˆã€‚\n"):C.info(`${i.errmsg}\n`)}catch(t){W.logErr(t,e)}finally{n(i)}})):n("")}))}function vt(t,e){return new Promise((n=>{const i={url:`https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=${ut}`,json:{msgtype:"text",text:{content:` ${t}\n\n${e}`}},headers:{"Content-Type":"application/json"},timeout:15e3};ut?W.post(i,((t,e,i)=>{try{t?(C.info("ä¼ä¸šå¾®ä¿¡å‘é€é€šçŸ¥æ¶ˆæ¯å¤±è´¥ï¼ï¼\n"),C.info(t)):0===(i=JSON.parse(i)).errcode?C.info("ä¼ä¸šå¾®ä¿¡å‘é€é€šçŸ¥æ¶ˆæ¯æˆåŠŸğŸ‰ã€‚\n"):C.info(`${i.errmsg}\n`)}catch(t){W.logErr(t,e)}finally{n(i)}})):n("")}))}function $t(t){const e=dt.split(",");if(e[2]){const n=e[2].split("|");let i="";for(let e=0;e<n.length;e++){const a="ç­¾åˆ°å· "+(e+1);t.match(a)&&(i=n[e])}return i||(i=e[2]),i}return"@all"}function Tt(t,e){return new Promise((n=>{if(dt){const i=dt.split(","),a={url:"https://qyapi.weixin.qq.com/cgi-bin/gettoken",json:{corpid:`${i[0]}`,corpsecret:`${i[1]}`},headers:{"Content-Type":"application/json"},timeout:15e3};W.post(a,((a,s,o)=>{const r=e.replace(/\n/g,"<br/>"),c=JSON.parse(o).access_token;let u;switch(i[4]){case"0":u={msgtype:"textcard",textcard:{title:`${t}`,description:`${e}`,url:"https://github.com/whyour/qinglong",btntxt:"æ›´å¤š"}};break;case"1":u={msgtype:"text",text:{content:`${t}\n\n${e}`}};break;default:u={msgtype:"mpnews",mpnews:{articles:[{title:`${t}`,thumb_media_id:`${i[4]}`,author:"æ™ºèƒ½åŠ©æ‰‹",content_source_url:"",content:`${r}`,digest:`${e}`}]}}}i[4]||(u={msgtype:"text",text:{content:`${t}\n\n${e}`}}),u={url:`https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=${c}`,json:{touser:`${$t(e)}`,agentid:`${i[3]}`,safe:"0",...u},headers:{"Content-Type":"application/json"}},W.post(u,((t,i,a)=>{try{t?(C.info("æˆå‘˜ID:"+$t(e)+"ä¼ä¸šå¾®ä¿¡åº”ç”¨æ¶ˆæ¯å‘é€é€šçŸ¥æ¶ˆæ¯å¤±è´¥ï¼ï¼\n"),C.info(t)):0===(a=JSON.parse(a)).errcode?C.info("æˆå‘˜ID:"+$t(e)+"ä¼ä¸šå¾®ä¿¡åº”ç”¨æ¶ˆæ¯å‘é€é€šçŸ¥æ¶ˆæ¯æˆåŠŸğŸ‰ã€‚\n"):C.info(`${a.errmsg}\n`)}catch(t){W.logErr(t,i)}finally{n(a)}}))}))}else n("")}))}function bt(t,e,n={}){return new Promise((i=>{if(ft){if(!new RegExp("^[a-zA-Z0-9]{24}$").test(ft))return C.info("æ‚¨æ‰€æä¾›çš„IGOT_PUSH_KEYæ— æ•ˆ\n"),void i("");const a={url:`https://push.hellyw.com/${ft.toLowerCase()}`,body:`title=${t}&content=${e}&${m.stringify(n)}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};W.post(a,((t,e,n)=>{try{t?(C.info("å‘é€é€šçŸ¥è°ƒç”¨APIå¤±è´¥ï¼ï¼\n"),C.info(t)):("string"==typeof n&&(n=JSON.parse(n)),0===n.ret?C.info("iGotå‘é€é€šçŸ¥æ¶ˆæ¯æˆåŠŸğŸ‰\n"):C.info(`iGotå‘é€é€šçŸ¥æ¶ˆæ¯å¤±è´¥ï¼š${n.errMsg}\n`))}catch(t){W.logErr(t,e)}finally{i(n)}}))}else i("")}))}function St(t,e){return new Promise((n=>{if(lt){e=e.replace(/[\n\r]/g,"<br>");const i={token:`${lt}`,title:`${t}`,content:`${e}`,topic:`${pt}`},a={url:"https://www.pushplus.plus/send",body:JSON.stringify(i),headers:{"Content-Type":" application/json"},timeout:15e3};W.post(a,((t,e,i)=>{try{t?(C.info(`push+å‘é€${pt?"ä¸€å¯¹å¤š":"ä¸€å¯¹ä¸€"}é€šçŸ¥æ¶ˆæ¯å¤±è´¥ï¼ï¼\n`),C.info(t)):200===(i=JSON.parse(i)).code?C.info(`push+å‘é€${pt?"ä¸€å¯¹å¤š":"ä¸€å¯¹ä¸€"}é€šçŸ¥æ¶ˆæ¯å®Œæˆã€‚\n`):C.info(`push+å‘é€${pt?"ä¸€å¯¹å¤š":"ä¸€å¯¹ä¸€"}é€šçŸ¥æ¶ˆæ¯å¤±è´¥ï¼š${i.msg}\n`)}catch(t){W.logErr(t,e)}finally{n(i)}}))}else n("")}))}async function It(t,e){C.info("----ã€æ¶ˆæ¯æ¨é€ã€‘----"),t=`Bili-${Q.NICKNAME}-${t}`,await async function(t,e,n={},i="\n\næœ¬é€šçŸ¥ Byï¼šhttps://github.com/catlair/BiliTools"){e+=i,await Promise.all([mt(t,e),St(t,e)]),await Promise.all([_t(t,e,n),yt(t,e),wt(t,e),vt(t,e),Tt(t,e),bt(t,e,n),gt(t,e),ht(t,e)])}(t,e,void 0,"")}function Ot(t){const e=Q.BILI_API_DELAY;let n;n=1===e.length?1e3*e[0]:1e3*O(e[0]||2,e[1]||6),n=t||n;const i=(new Date).getTime()+parseInt(n,10);for(;(new Date).getTime()<i;);return new Promise((t=>{t("done")}))}process.env.PUSH_KEY&&(z=process.env.PUSH_KEY),process.env.QQ_SKEY&&process.env.QQ_SKEY,process.env.QQ_MODE&&process.env.QQ_MODE,process.env.BARK_PUSH?(V=process.env.BARK_PUSH.indexOf("https")>-1||process.env.BARK_PUSH.indexOf("http")>-1?process.env.BARK_PUSH:`https://api.day.app/${process.env.BARK_PUSH}`,process.env.BARK_SOUND&&(Z=process.env.BARK_SOUND),process.env.BARK_GROUP&&(tt=process.env.BARK_GROUP)):V&&-1===V.indexOf("https")&&-1===V.indexOf("http")&&(V=`https://api.day.app/${V}`),process.env.TG_BOT_TOKEN&&(et=process.env.TG_BOT_TOKEN),process.env.TG_USER_ID&&(nt=process.env.TG_USER_ID),process.env.TG_PROXY_AUTH&&(st=process.env.TG_PROXY_AUTH),process.env.TG_PROXY_HOST&&(it=process.env.TG_PROXY_HOST),process.env.TG_PROXY_PORT&&(at=process.env.TG_PROXY_PORT),process.env.TG_API_HOST&&(ot=process.env.TG_API_HOST),process.env.DD_BOT_TOKEN&&(rt=process.env.DD_BOT_TOKEN,process.env.DD_BOT_SECRET&&(ct=process.env.DD_BOT_SECRET)),process.env.QYWX_KEY&&(ut=process.env.QYWX_KEY),process.env.QYWX_AM&&(dt=process.env.QYWX_AM),process.env.IGOT_PUSH_KEY&&(ft=process.env.IGOT_PUSH_KEY),process.env.PUSH_PLUS_TOKEN&&(lt=process.env.PUSH_PLUS_TOKEN),process.env.PUSH_PLUS_USER&&(pt=process.env.PUSH_PLUS_USER);const Et={"User-Agent":Q.USER_AGENT||"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36 Edg/96.0.1054.62","content-type":"application/x-www-form-urlencoded","accept-language":"accept-language: zh-CN,zh;q=0.9,en-GB;q=0.8,en;q=0.7"};var Ct;T.default.defaults.headers.common.Cookie=Q.COOKIE,T.default.defaults.withCredentials=!0,T.default.defaults.headers.common["User-Agent"]=Et["User-Agent"],T.default.defaults.headers.post["content-type"]=Et["content-type"],T.default.defaults.headers.common["accept-language"]=Et["accept-language"],function(t){t[t["åº”ç”¨ç¨‹åºä¸å­˜åœ¨æˆ–å·²è¢«å°ç¦"]=-1]="åº”ç”¨ç¨‹åºä¸å­˜åœ¨æˆ–å·²è¢«å°ç¦",t[t["Access Keyé”™è¯¯"]=-2]="Access Keyé”™è¯¯",t[t["APIæ ¡éªŒå¯†åŒ™é”™è¯¯"]=-3]="APIæ ¡éªŒå¯†åŒ™é”™è¯¯",t[t["è°ƒç”¨æ–¹å¯¹è¯¥Methodæ²¡æœ‰æƒé™"]=-4]="è°ƒç”¨æ–¹å¯¹è¯¥Methodæ²¡æœ‰æƒé™",t[t["è´¦å·æœªç™»å½•"]=-101]="è´¦å·æœªç™»å½•",t[t["è´¦å·è¢«å°åœ"]=-102]="è´¦å·è¢«å°åœ",t[t["ç§¯åˆ†ä¸è¶³"]=-103]="ç§¯åˆ†ä¸è¶³",t[t["ç¡¬å¸ä¸è¶³"]=-104]="ç¡¬å¸ä¸è¶³",t[t["éªŒè¯ç é”™è¯¯"]=-105]="éªŒè¯ç é”™è¯¯",t[t["è´¦å·éæ­£å¼ä¼šå‘˜æˆ–åœ¨é€‚åº”æœŸ"]=-106]="è´¦å·éæ­£å¼ä¼šå‘˜æˆ–åœ¨é€‚åº”æœŸ",t[t["åº”ç”¨ä¸å­˜åœ¨æˆ–è€…è¢«å°ç¦"]=-107]="åº”ç”¨ä¸å­˜åœ¨æˆ–è€…è¢«å°ç¦",t[t["æœªç»‘å®šæ‰‹æœº?"]=-108]="æœªç»‘å®šæ‰‹æœº?",t[t["æœªç»‘å®šæ‰‹æœº"]=-110]="æœªç»‘å®šæ‰‹æœº",t[t["csrf æ ¡éªŒå¤±è´¥"]=-111]="csrf æ ¡éªŒå¤±è´¥",t[t["ç³»ç»Ÿå‡çº§ä¸­"]=-112]="ç³»ç»Ÿå‡çº§ä¸­",t[t["è´¦å·å°šæœªå®åè®¤è¯"]=-113]="è´¦å·å°šæœªå®åè®¤è¯",t[t["è¯·å…ˆç»‘å®šæ‰‹æœº"]=-114]="è¯·å…ˆç»‘å®šæ‰‹æœº",t[t["è¯·å…ˆå®Œæˆå®åè®¤è¯"]=-115]="è¯·å…ˆå®Œæˆå®åè®¤è¯"}(Ct||(Ct={}));const xt="https://account.bilibili.com",Nt="https://live.bilibili.com",At="https://www.bilibili.com/",Pt="https://account.bilibili.com",kt="https://api.live.bilibili.com",Lt="https://api.bilibili.com",Rt="https://manga.bilibili.com",Ut="https://api.vc.bilibili.com";T.default.interceptors.response.use((t=>{var e,n;const i=(null===(e=t.headers)||void 0===e?void 0:e["set-cookie"])||[];Q.COOKIE=H(Q.COOKIE,i);const a=null===(n=t.data)||void 0===n?void 0:n.code;switch(a){case Ct["è´¦å·æœªç™»å½•"]:case Ct["è´¦å·è¢«å°åœ"]:(async()=>{C.error(`è¿è¡Œç»“æŸï¼š${Ct[a]}`),await It(`å¼‚å¸¸ï¼š${Ct[a]}`,E.value),process.exit(0)})();break;default:return t}}),(t=>function(t){const e=t.config;if(0===e.retry)return Promise.reject(t);e.retry||(e.retry=2);if(e.__retryCount=e.__retryCount||0,e.__retryCount>=e.retry)return Promise.reject(t);e.__retryCount+=1;return new Promise((function(t){setTimeout((function(){t(void 0)}),e.retryDelay||100)})).then((function(){return T.default(e)}))}(t)));const Bt=T.default.create({baseURL:Pt}),Dt=T.default.create({baseURL:kt,headers:{Referer:At}}),Gt=T.default.create({baseURL:Lt,headers:{Referer:At}}),Mt=T.default.create({baseURL:Rt}),Ht=T.default.create({baseURL:Ut});async function Kt(t=3394945){const e=(new Date).getTime(),{data:n}=await Dt.get(`/xlive/web-room/v1/gift/bag_list?t=${e}&room_id=${t}`);return n}async function jt(t=1,e=10){t>10&&(t=10);const{data:n}=await Dt.get(`/xlive/app-ucenter/v1/user/GetMyMedals?page=${t}&page_size=${e}`);return n}async function qt({ruid:t,gift_num:e,bag_id:n,gift_id:i,roomid:a}){const s=Q.BILIJCT,o=s,r=u.stringify({gift_id:i,ruid:t,gift_num:e,bag_id:n,biz_id:a,rnd:(new Date).getTime(),send_ruid:0,storm_beat_id:0,metadata:"",price:0,visit_id:"",csrf:s,platform:"pc",biz_code:"Live",csrf_token:o,uid:Q.USERID}),{data:c}=await Dt.post("/xlive/revenue/v2/gift/sendBag",r,{headers:{Origin:Nt}});return c}function Jt(t,e,n,i,a){const s=j(),o=s,r=[K(G,"LIVE_BUVID")||"","xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))];return{ua:Q.USER_AGENT,id:[n,e,a,t],csrf_token:s,csrf:o,device:r,uname:i}}async function Yt(){try{await async function(){const{data:t}=await T.default.get("https://api.live.bilibili.com/relation/v1/Feed/heartBeat");return t}()}catch{}}async function Qt(t){const{data:{area_id:e,parent_area_id:n,room_id:i}}=await async function(t){const{data:e}=await Dt.get(`/room/v1/Room/get_info?room_id=${t}&from=room`);return e}(t);return{room_id:i,area_id:e,parent_area_id:n}}async function Ft(t,e){const n={id:JSON.stringify(t.id),device:JSON.stringify(t.device),ts:(new Date).getTime(),is_patch:0,heart_beat:"[]",ua:t.ua,visit_id:"",csrf:t.csrf,csrf_token:t.csrf_token};try{const{data:i,code:a}=await async function(t){const{data:e}=await T.default.post("https://live-trace.bilibili.com/xlive/data-interface/v1/x25Kn/E",u.stringify(t));return e}(n);if(0===a)return C.info(`è¿›å…¥ã€${t.uname}ã€‘çš„ç›´æ’­é—´`),e.v++,i}catch(t){C.verbose(t)}}async function Xt(t,e,n){if(n.v>6)return;const i={id:JSON.stringify(e.id),device:JSON.stringify(e.device),ets:t.timestamp,benchmark:t.secret_key,time:60,ts:(new Date).getTime(),ua:e.ua},a=function(t,e){const[n,i,a,s]=JSON.parse(t.id),[o,r]=JSON.parse(t.device),{ets:c,time:u,ts:d}=t,f={platform:"web",parent_id:n,area_id:i,seq_id:a,room_id:s,buvid:o,uuid:r,ets:c,time:u,ts:d},l=t.benchmark,p=["MD5","SHA1","SHA256","SHA224","SHA512","SHA384"];let g=JSON.stringify(f);for(const t of e)g=$.createHmac(p[t],l).update(g).digest("hex");return g}(i,t.secret_rule);try{const{data:t,code:s,message:o}=await async function(t){const{data:e}=await T.default.post("https://live-trace.bilibili.com/xlive/data-interface/v1/x25Kn/X",u.stringify(t));return e}(Object.assign({visit_id:"",csrf:e.csrf,csrf_token:e.csrf_token,s:a},i));return 0===s?(C.info(`å‘ã€${e.uname}ã€‘å‘é€ç¬¬${n.v}æ¬¡å¿ƒè·³`),n.v++):C.warn(`å‘ã€${e.uname}ã€‘å‘é€ç¬¬${n.v}æ¬¡å¿ƒè·³å¤±è´¥ ${s} ${o}`),t}catch(t){C.verbose(t)}}async function Wt(t=1,e=10){try{const{code:n,message:i,data:a}=await jt(t,e);return 0!==n?(C.verbose(`è·å–ç›´æ’­é—´å¤±è´¥ ${n} ${i}`),null):a}catch(t){return C.verbose(`è·å–ç›´æ’­é—´å¼‚å¸¸ ${t.message}`),null}}async function zt(t=!0){const e=await async function(){let t=0;try{var e,n;const{data:i,code:a}=await Kt();return 0!==a||(null===(e=i.list)||void 0===e?void 0:e.length)<=0?24:(null===(n=i.list)||void 0===n||n.forEach((e=>{if(30607===e.gift_id){const n=(1e3*e.expire_at-(new Date).getTime())/X.MS2DATE;n>6&&n<=7&&(t+=e.gift_num)}})),t>=24?0:24-t)}catch(t){}return 24}();let n;return t?n=await async function(){const{items:t,page_info:e}=await Wt();let{total_page:n}=e;if(n&&n>1){n=n>3?3:n;for(let e=2;e<=n;e++){const n=await Wt(e,10);t.push(...n.items)}}return t}():({items:n}=await Wt()),{fansMedalList:n,heartNum:e}}async function Vt(){C.info("----ã€ç›´æ’­å¿ƒè·³ã€‘----");const{heartNum:t,fansMedalList:e}=await zt(),n=e&&e.length;if(!n)return void C.info("æ²¡æœ‰å‹‹ç« åˆ—è¡¨");const i=Math.ceil(t/n);for(let n=0;n<i;n++)await te(e,t);C.info("å®Œæˆ")}async function Zt(t,e,n,i){if(!i.v||e[n])return await Yt(),await Ot(500),0===i.v?e[n]=await Ft(t,i):e[n]=await Xt(e[n],t,i),"done"}async function te(t,e){const n=[];let i=0;for(let a=0;a<6;a++){let s=0;if(s>=e)break;const o=t.length;i=0;for(let r=0;r<o&&!(s>=e);r++){const e=(new Date).getTime(),o=t[r],{roomid:c,uname:u}=o,{room_id:d,area_id:f,parent_area_id:l}=await Qt(c),p=Jt(d,f,l,u,a);await Zt(p,n,r,{v:a}),await Ot(2e3),i+=(new Date).getTime()-e,s++}a<5&&await Ot(6e4-i)}return"done"}const ee={silver2Coin:!0,liveSignTask:!0,addCoins:!0,mangaSign:!1,shareAndWatch:!0,supGroupSign:!1,liveSendMessage:!1,taskReward:!0,charging:!1,getVipPrivilege:!1,giveGift:!1,matchGame:!1};function ne(t){return function(){for(const t in ee)if(Object.prototype.hasOwnProperty.call(ee,t)){const e=ee[t];switch((Q.config.function||{})[t]){case!0:!1===e&&(ee[t]=!0);break;case!1:!0===e&&(ee[t]=!1)}}ee.addCoins||ee.shareAndWatch||(ee.taskReward=!1)}(),t.map((t=>ee[t.name]?t:null)).filter((t=>t))}async function ie(){const{data:t}=await Gt.get("/x/web-interface/nav",{retry:3,headers:{Origin:xt}});return t}async function ae(){const{data:t}=await Gt.get("/x/web-interface/coin/today/exp");return t}function se(t){const e=t.level_info,n=e.current_level;if(n>=Q.BILI_TARGET_LEVEL&&(F.coinsTask=0),C.info(`å½“å‰ç­‰çº§: ${e.current_level}`),n>=6)ee.shareAndWatch=!1,ee.addCoins=!1,C.info("å·²ç»æ»¡çº§ï¼Œä¸éœ€è¦å†æŠ•å¸äº†ï¼Œåšä¸ªç™½å«–æ€ªå§");else{const t=e.next_exp-e.current_exp;C.info(`è·ç¦»å‡çº§è¿˜éœ€è¦ ${t} ç»éªŒï¼Œé¢„è®¡ ${function(t){if(Q.BILI_TARGET_COINS<=0)return t/15;const e=10*Q.BILI_TARGET_COINS+15,n=t/e,i=F.money/(Q.BILI_TARGET_COINS-1);return n<i?Math.floor(n):(t-i*e)/25+i}(t).toFixed(2)} å¤©`)}}async function oe(t){try{var e;const{data:n}=await async function(){const{data:t}=await Bt.get("/site/getCoin");return t}();C.info(`ç™»å½•æˆåŠŸ: ${t.uname}`),C.info(`ç¡¬å¸ä½™é¢: ${n.money||0}`),Q.NICKNAME=function(t){const e=t.length;return e<=3?t:`${t[0]}**${t[e-1]}`}(t.uname),F.money=n.money||0,F.bCoinCouponBalance=(null===(e=t.wallet)||void 0===e?void 0:e.coupon_balance)||0,se(t),function(t){let e="";switch(F.vipType=t.vipType,t.vipType){case 0:e="æ— å¤§ä¼šå‘˜";break;case 1:e="æœˆåº¦å¤§ä¼šå‘˜";break;case 2:e="å¹´åº¦å¤§ä¼šå‘˜"}0===t.vipStatus&&(e="æ— å¤§ä¼šå‘˜"===e?e:e+"[å·²è¿‡æœŸ]"),C.info(`å¤§ä¼šå‘˜çŠ¶æ€: ${e}`)}(t)}catch(t){C.error(`è·å–ç¡¬å¸ä¿¡æ¯å¼‚å¸¸: ${t.message}`)}}async function re(t,e=12,n=1){try{const{data:i}=await Gt.get("/x/space/article",{params:{callback:"__test",jsonp:"jsonp",sort:"publish_time",pn:n,ps:e,mid:t}});return function(t){const e=t.replace(/^\w+\(/,"").replace(/\)$/,"");return JSON.parse(e)}(i)}catch(t){console.log(t)}}async function ce(t,e,n=1){const{data:i}=await Gt.post("/x/web-interface/coin/add",u.stringify({aid:t,multiply:e,selectLike:n,csrf:Q.BILIJCT}));return i}async function ue(t,e=1){const{data:n}=await T.default.post("https://www.bilibili.com/audio/music-service-c/web/coin/add",u.stringify({sid:t,multiply:e,csrf:Q.BILIJCT}));return n}const de="video",fe="audio",le="article";async function pe(t=!0){try{const e=Q.USERID;let n;n=t?await async function(t=1,e=50){const{data:n}=await Gt.get("/x/relation/tag",{params:{tagid:-10,pn:t,ps:e}});return n}():await async function(t,e=1,n=50,i="desc",a="attention"){const{data:s}=await Gt.get("/x/relation/followings",{params:{vmid:t,pn:e,ps:n,order:i,order_type:a}});return s}(e);const{data:i,message:a,code:s}=n;if(0===s&&i.length>0){await Ot();const{mid:t}=i[O(i.length-1)];return await me(t)}return 0===i.length?{msg:"-1",data:{}}:{msg:t?`æœªè·å–åˆ°ç‰¹åˆ«å…³æ³¨åˆ—è¡¨: ${s}-${a}`:`æœªè·å–åˆ°å…³æ³¨åˆ—è¡¨: ${s}-${a}`,data:{}}}catch(t){return{msg:t.message,data:{}}}}async function ge(){const t=[1,3,4,5,160,22,119],e=t[O(t.length-1)];try{const{data:t,message:n,code:i}=await async function(t=1,e=3){const{data:n}=await Gt.get("/x/web-interface/ranking/region",{params:{rid:t,day:e}});return n}(e,3);if(0==i){const{aid:e,title:n,author:i}=t[O(t.length-1)];return{msg:"0",data:{id:Number(e),title:n,author:i}}}return{msg:`æœªè·å–åˆ°æ’è¡Œä¿¡æ¯: ${i}-${n}`,data:{}}}catch(t){return{msg:t.message,data:{}}}}async function he(){const t=Q.BILI_CUSTOMIZE_UP;if(0===t.length)return{msg:"-1",data:{}};const e=t[O(t.length-1)];return await me(e)}async function me(t){try{const{code:e,data:n,message:i}=await async function(t){const{data:e}=await Gt.get(`/x/space/navnum?mid=${t}`);return e}(t);if(e)return{msg:`é€šè¿‡uidè·å–è§†é¢‘å¤±è´¥: ${e}-${i}`,data:{}};await Ot();const{video:a,audio:s,article:o}=n,{type:r,page:c,index:u}=function([t,e,n]){const i=t+e+n;if(!i)return;const a=O(0,i-1);let s=a;if(a<t)return{type:de,page:I(30,s+1),index:s%30};const o=t+e;return s=a-t,a<o?{type:fe,page:I(30,s+1),index:s%30}:(s=a-o,{type:le,page:I(12,s+1),index:s%12})}([a,s,o]),d={[de]:_e,[fe]:ye,[le]:we},f=await d[r](t,c,u);return f.message?{msg:f.message,data:{}}:{msg:"0",data:f}}catch(t){return C.debug(t),{msg:t.message,data:{}}}}async function _e(t,e,n){const{code:i,data:a,message:s}=await async function(t,e=30,n=1,i=""){const{data:a}=await Gt.get("/x/space/arc/search",{params:{jsonp:"jsonp",order:"pubdate",keyword:i,pn:n,tid:0,ps:e,mid:t}});return a}(t,30,e);if(i)return{message:s};const{aid:o,title:r,author:c}=a.list.vlist[n];return{type:de,id:o,title:r,author:c}}async function ye(t,e,n){const{code:i,data:a,msg:s}=await async function(t,e=30,n=1){const{data:i}=await Gt.get("/audio/music-service/web/song/upper",{params:{jsonp:"jsonp",order:1,pn:n,ps:e,uid:t}});return i}(t,30,e);if(i)return{message:s};const{data:o}=a,{id:r,uname:c,title:u}=o[n];return{type:fe,id:r,title:u,author:c}}async function we(t,e,n){const{code:i,data:a,message:s}=await re(t,12,e);if(i)return{message:s};const{articles:o}=a,{id:r,title:c,author:{name:u}}=o[n];return{type:le,id:r,title:c,author:u,mid:t}}async function ve(){let t;const e=[he,pe,()=>pe(!1),ge];Q.BILI_CUSTOMIZE_UP||e.shift(),e.splice(0,F.currentStartFun);for(let n=0;n<e.length;n++){const i=e[n];if(t=await i(),"0"===t.msg)return t;let a=Number(Q.BILI_COIN_RETRY_NUM??4);for(a=a<1?1:a>8?8:a;a--;)if(await Ot(),t=await i(),"-1"===t.msg&&(a=0),"0"===t.msg)return t;a<=0&&(F.currentStartFun=n)}return{msg:"-1",data:{id:0}}}async function $e({id:t,coin:e=1,type:n="video",mid:i}){const a={[de]:ce,[fe]:ue,[le]:(t,e=1)=>async function(t,e,n=1){const{data:i}=await Gt.post("/x/web-interface/coin/add",u.stringify({aid:e,upid:t,avtype:2,multiply:n,csrf:Q.BILIJCT}));return i}(i,t,e)},s=await a[n](Number(t),e);return{code:s.code,message:s.message||s.msg}}async function Te(t,e){const{data:n}=await Ht.get("/link_setting/v1/link_setting/sign_in",{params:{group_id:t,owner_id:e}});return n}async function be(){try{const{data:t,code:e,message:n}=await async function(){const{data:t}=await Ht.get("/link_group/v1/member/my_groups");return t}();return 0===e?(null==t?void 0:t.list)||[]:(C.warn(`è·å–è‡ªå·±çš„åº”æ´å›¢å¼‚å¸¸å¤±è´¥: ${n}`),[])}catch(t){C.error(`è·å–è‡ªå·±çš„åº”æ´å›¢å¼‚å¸¸: ${t}`)}}const Se=["æ£’","æ£’å”‰","æ£’è€¶","åŠ æ²¹~","UPåŠ æ²¹!","æ”¯æŒ~","æ”¯æŒæ”¯æŒï¼","å‚¬æ›´å•¦","é¡¶é¡¶","ç•™ä¸‹è„šå°~","å¹²æ¯","bilibiliå¹²æ¯","o(*ï¿£â–½ï¿£*)o","(ï½¡ï½¥âˆ€ï½¥)ï¾‰ï¾å—¨","(â—Ë‡âˆ€Ë‡â—)","( â€¢Ì€ Ï‰ â€¢Ì )y","(à¸‡ â€¢_â€¢)à¸‡",">.<","^_~"],Ie=["(âŒ’â–½âŒ’)","ï¼ˆï¿£â–½ï¿£ï¼‰","(=ãƒ»Ï‰ãƒ»=)","(ï½€ãƒ»Ï‰ãƒ»Â´)","(ã€œï¿£â–³ï¿£)ã€œ","(ï½¥âˆ€ï½¥)","(Â°âˆ€Â°)ï¾‰","(ï¿£3ï¿£)","â•®(ï¿£â–½ï¿£)â•­","_(:3ã€âˆ )_","( Â´_ã‚ï½€)","â†_â†","â†’_â†’","(<_<)","(>_>)","(;Â¬_Â¬)","(ï¾ŸĞ”ï¾Ÿâ‰¡ï¾ŸĞ´ï¾Ÿ)!?","Î£(ï¾ŸĞ´ï¾Ÿ;)","Î£( ï¿£â–¡ï¿£||)","(Â´ï¼›Ï‰ï¼›`)","ï¼ˆ/TĞ”T)/","(^ãƒ»Ï‰ãƒ»^ )","(ï½¡ï½¥Ï‰ï½¥ï½¡)","(â—ï¿£(ï½´)ï¿£â—)","Îµ=Îµ=(ãƒâ‰§âˆ‡â‰¦)ãƒ","(Â´ï½¥_ï½¥`)","(-_-#)","ï¼ˆï¿£ã¸ï¿£ï¼‰","(ï¿£Îµ(#ï¿£) Î£","ãƒ½(`Ğ”Â´)ï¾‰","ï¼ˆ#-_-)â”¯â”â”¯","(â•¯Â°å£Â°)â•¯(â”´â€”â”´","â†â—¡â†","( â™¥Ğ´â™¥)","Î£>â€•(ã€ƒÂ°Ï‰Â°ã€ƒ)â™¡â†’","â„(â„ â„â€¢â„Ï‰â„â€¢â„ â„)â„","(â•¬ï¾ŸĞ´ï¾Ÿ)â–„ï¸»â”»â”³â•ä¸€","ï½¥*ï½¥:â‰¡(ã€€Îµ:)","(æ±—)","(è‹¦ç¬‘)"].concat("1","2","3","4","5","6","7","8","9","ç­¾åˆ°","å“ˆå“ˆ");async function Oe(){try{const{code:t,message:e,data:n}=await async function(t=1,e=256,n=1){const{data:i}=await Dt.get(`/xlive/app-ucenter/v1/fansMedal/panel?page=${t}&page_size=${e}&target_id=${n}`);return i}(1,256,Q.USERID);return 0!==t?(C.verbose(`è·å–å‹‹ç« ä¿¡æ¯å¤±è´¥ ${t} ${e}`),null):n}catch(t){return C.error(`è·å–å‹‹ç« å¼‚å¸¸ ${t.message}`),null}}async function Ee(t,e){const n=Ie[O(Ie.length-1)];try{const{code:i,message:a}=await async function(t,e){const n=Q.BILIJCT,i=n;e||(e=O(10).toString());const{data:a}=await Dt.post("/msg/send",u.stringify({color:5566168,fontsize:25,mode:1,msg:e,rnd:Date.now(),roomid:t,bubble:0,csrf:n,csrf_token:i}));return a}(t,n);return 0===i||(11e3===i?(C.warn(`ã€${e}ã€‘${t}-å¯èƒ½æœªå¼€å¯è¯„è®º`),!1):(C.warn(`ã€${e}ã€‘${t}-å‘é€å¤±è´¥ ${a}`),C.verbose(`code: ${i}`),!1))}catch(t){C.verbose(`å‘é€å¼¹å¹•å¼‚å¸¸ ${t.message}`)}}async function Ce(){try{const{data:t,message:e,code:n}=await ie();if(0!==n)return void C.warn(`è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥ï¼š${n} ${e}`);!function(t){var e;F.bCoinCouponBalance=(null===(e=t.wallet)||void 0===e?void 0:e.coupon_balance)||0}(t)}catch(t){C.error(`è·å–ç”¨æˆ·ä¿¡æ¯å¼‚å¸¸ï¼š${t.message}`)}}var xe;async function Ne(t){try{const e=function(t){switch(t){case 1:return"B å¸åˆ¸";case 2:return"å¤§ä¼šå‘˜ä¼˜æƒ åˆ¸";default:return""}}(t),{code:n,message:i}=await async function(t=1){const{data:e}=await Gt.post("/x/vip/privilege/receive",u.stringify({csrf:Q.BILIJCT,type:t}));return e}(t);let a="æˆåŠŸ";return 0===n&&(a=`å¤±è´¥ ${i}`),C.info(`é¢†å–${e} ${a}`),!0}catch(t){C.error(`é¢†å–æƒç›Šå‡ºç°å¼‚å¸¸ï¼š${t.message}`)}return!1}async function Ae(t){let e=0,n=!1;for(;!(n||(n=await Ne(t),e>2));)e++;return n}!function(t){t[t["æˆåŠŸ"]=4]="æˆåŠŸ",t[t["ä½äº20ç”µæ± "]=-2]="ä½äº20ç”µæ± ",t[t["Bå¸ä¸è¶³"]=-4]="Bå¸ä¸è¶³"}(xe||(xe={}));const{BILI_GIFT_UP:Pe}=Q;let ke=0;async function Le(){try{const{data:{list:t}}=await Kt();return t.filter((t=>!![1,30607].includes(t.gift_id)&&(1e3*t.expire_at-(new Date).getTime())/X.MS2DATE<2))}catch(t){if(ke)return null;await Le(),ke++}}async function Re(t){try{const{data:{live_room:e}}=await async function(t){const{data:e}=await Gt.get(`/x/space/acc/info?mid=${t}&jsonp=jsonp`);return e}(t);if(await Ot(),e.roomStatus)return{roomid:e.roomid}}catch{}return{roomid:0}}const Ue=Q.BILIJCT,Be=Ue;async function De(t,e,n,i){const a=u.stringify({is_fav:0,main_id:e,oid:t,detail_id:n,count:i,csrf:Ue,csrf_token:Be}),{data:s}=await Gt.post("/x/esports/guess/add",a);return s}const{MATCH_SELECTION:Ge,MATCH_COINS:Me}=Q;function He(){return F.money-Me<Q.BILI_TARGET_COINS&&(C.info(`éœ€è¦ä¿ç•™${Q.BILI_TARGET_COINS}ä¸ªç¡¬å¸ï¼Œä»»åŠ¡ç»“æŸ`),!0)}var Ke={taskReward:async function(){C.info("----ã€æ¯æ—¥ä»»åŠ¡å®Œæˆæƒ…å†µã€‘----");try{const{data:t,message:e,code:n}=await async function(){const{data:t}=await Gt.get("/x/member/web/exp/reward");return t}();await Ot();const{data:i}=await ae();if(0!=n)return void C.warn(`çŠ¶æ€è·å–å¤±è´¥: ${n} ${e}`);const a=F.money-Q.BILI_STAY_COINS;let s=0;0===F.coinsTask?C.info(`ä»Šæ—¥æŠ•å¸è·å–ç»éªŒ: ${i}ï¼Œè¿˜éœ€æŠ•å¸0é¢—ï¼Œç»éªŒå¤Ÿäº†ï¼Œä¸æƒ³æŠ•äº†`):a<=0?C.info(`ä»Šæ—¥æŠ•å¸è·å–ç»éªŒ: ${i}ï¼Œè¿˜éœ€æŠ•å¸0é¢—ï¼Œç¡¬å¸ä¸å¤Ÿäº†ï¼Œä¸æŠ•å¸äº†`):a<F.coinsTask?(s=F.coinsTask-a,C.info(`æŠ•å¸è·å–ç»éªŒ: ${i}ï¼Œè¿˜éœ€æŠ•å¸æ•°é‡: ${s}é¢—;(ç›®æ ‡${F.coinsTask}é¢—ï¼Œå¿½ç•¥éƒ¨åˆ†æŠ•å¸)`)):(s=F.coinsTask-i/10,C.info(`æŠ•å¸è·å–ç»éªŒ: ${i}ï¼Œè¿˜éœ€æŠ•å¸æ•°é‡: ${s}é¢—;(ç›®æ ‡${F.coinsTask}é¢—)`)),F.coinsTask=s,C.info("æ¯æ—¥åˆ†äº«: "+(t.share?"å·²å®Œæˆ":"[æœªå®Œæˆ]")),C.info("æ¯æ—¥æ’­æ”¾: "+(t.watch?"å·²å®Œæˆ":"[æœªå®Œæˆ]")),F.share=t.share,F.watch=t.watch}catch(t){C.error(`çŠ¶æ€è·å–å¼‚å¸¸ ${t.message}`)}},liveSignTask:async function(){C.info("----ã€ç›´æ’­ç­¾åˆ°ã€‘----");try{const{data:t}=await async function(){const{data:t}=await Dt.get("/xlive/web-ucenter/v1/sign/WebGetSignInfo");return t}();if(1===t.status)return C.info("å·²ç­¾åˆ°ï¼Œè·³è¿‡ç­¾åˆ°"),void C.info(`å·²ç»ç­¾åˆ°${t.hadSignDays}å¤©ï¼Œ${t.specialText}`)}catch(t){}try{const{code:t,data:e,message:n}=await async function(){const{data:t}=await Dt.get("/xlive/web-ucenter/v1/sign/DoSign");return t}();0===t?C.info(`ç›´æ’­ç­¾åˆ°æˆåŠŸ: ${e.text}ï¼Œç‰¹åˆ«ä¿¡æ¯: ${e.specialText}ï¼Œæœ¬æœˆç­¾åˆ°å¤©æ•°: ${e.hadSignDays}å¤©;`):C.warn(`ç›´æ’­ç­¾åˆ°å¤±è´¥: ${t} ${n}`)}catch(t){C.error(`ç›´æ’­ç­¾åˆ°å¼‚å¸¸: ${t.message}`)}},shareAndWatch:async function(){if(C.info("----ã€åˆ†äº«/æ’­æ”¾è§†é¢‘ã€‘----"),F.share&&F.watch)return void C.info("å·²å®Œæˆï¼Œè·³è¿‡åˆ†äº«/æ’­æ”¾");let t=0;try{let e=await he();if("-1"===e.msg&&(e=await ge()),"0"!==e.msg)return C.warn(`è·å–è§†é¢‘å¤±è´¥ ${e.msg}`),!1;{const{id:n,author:i,title:a}=e.data;t=n,C.info(`è·å–è§†é¢‘: ${a} --upã€${i}ã€‘`)}}catch(t){return C.error(`è·å–è§†é¢‘å‡ºç°å¼‚å¸¸: ${t.message}`),!1}if(!F.share){await Ot();try{const{code:e,message:n}=await async function(t){const e={csrf:Q.BILIJCT,aid:t},{data:n}=await Gt.post("/x/web-interface/share/add",u.stringify(e));return n}(t);0===e?C.info("åˆ†äº«è§†é¢‘æˆåŠŸ!"):C.warn(`åˆ†äº«è§†é¢‘å¤±è´¥: ${e} ${n}`)}catch(t){C.error(`åˆ†äº«è§†é¢‘å¼‚å¸¸: ${t.message}`)}}if(!F.watch){await Ot();try{const{code:e,message:n}=await async function(t,e){const{data:n}=await Gt.post("/x/click-interface/web/heartbeat",u.stringify({aid:t,played_time:e}));return n}(t,O(4,60));0===e?C.info("æ’­æ”¾è§†é¢‘æˆåŠŸ!"):C.warn(`æ’­æ”¾è§†é¢‘å¤±è´¥: ${e} ${n}`)}catch(t){C.error(`æ’­æ”¾è§†é¢‘å¼‚å¸¸: ${t.message}`)}}},silver2Coin:async function(){C.info("----ã€é“¶ç“œå­å…‘æ¢ç¡¬å¸ã€‘----");try{const{data:t,code:e,message:n}=await async function(){const{data:t}=await Dt.get("/xlive/revenue/v1/wallet/getStatus");return t}();if(0!=e&&C.info(`è·å–ç“œå­è¯¦æƒ…å¤±è´¥ ${n}`),0===t.silver_2_coin_left)C.info("ä»Šæ—¥å·²å…‘æ¢ä¸€æ¬¡");else if(t.silver<700)C.info("å…‘æ¢å¤±è´¥ï¼Œä½ ç“œå­ä¸å¤Ÿäº†");else{const{message:t}=await async function(){const{data:t}=await Dt.post("/xlive/revenue/v1/wallet/silver2coin",u.stringify({csrf_token:Q.BILIJCT,csrf:Q.BILIJCT}));return t}();C.info(t),await async function(){const{data:t}=await Dt.get("/xlive/revenue/v1/wallet/myWallet?need_bp=1&need_metal=1&platform=pc");return t}()}}catch(t){C.error(`æ“ä½œå¼‚å¸¸ ${t.message}`)}},addCoins:async function(){if(C.info("----ã€è§†é¢‘æŠ•å¸ã€‘----"),!F.coinsTask)return void C.info("è·³è¿‡æŠ•å¸ï¼Œä»Šæ—¥å·²å®Œæˆ");let t,e=0,n=0;for(;F.coinsTask&&n<5;){try{const{data:t,code:e}=await ae();if(0==e){const e=Q.BILI_TARGET_COINS-t/10;F.coinsTask=e>0?e:0}}catch(t){}if(F.coinsTask<=0||F.money<=0)break;const{data:i,msg:a}=await ve();if(null==i||!i.id||"0"!=a){n++;continue}await Ot();const{id:s,title:o,author:r,type:c,mid:u}=i;try{const i=await $e({id:s,type:c,mid:u});if(0===i.code)F.money--,F.coinsTask--,e++,C.info(`ç»™[${o}--upã€${r}ã€‘]æŠ•å¸æˆåŠŸ`);else{if(n++,-111===i.code||-104===i.code){C.warn(`${s} ${i.message} æ— æ³•ç»§ç»­è¿›è¡ŒæŠ•å¸`);break}if(C.warn(`ç»™upæŠ•å¸å¤±è´¥ ${i.code} ${i.message}`),t===i.code)break;t=i.code}}catch(t){n++,C.error(`æŠ•å¸å¼‚å¸¸ ${t.message}`)}finally{await Ot(1500)}}n>=5&&C.info("å‡ºç°å¼‚å¸¸/é”™è¯¯5æ¬¡ï¼Œè‡ªåŠ¨é€€å‡ºæŠ•å¸"),C.info(`ä¸€å…±æˆåŠŸæŠ•å¸${e}é¢—`),C.info(`ç¡¬å¸è¿˜å‰©${F.money}é¢—`)},mangaSign:async function(){C.info("----ã€æ¼«ç”»ç­¾åˆ°ã€‘----");try{const{code:t}=await async function(t="android"){const{data:e}=await Mt.post("/twirp/activity.v1.Activity/ClockIn",u.stringify({platform:t}));return e}();0==t?C.info("æ¼«ç”»ç­¾åˆ°æˆåŠŸ"):C.warn("æ¼«ç”»ç­¾åˆ°å¤±è´¥")}catch(t){400===t.response.status?C.info("å·²ç»ç­¾åˆ°è¿‡äº†ï¼Œè·³è¿‡ä»»åŠ¡"):C.error(`æ¼«ç”»ç­¾åˆ°å¼‚å¸¸ ${t.message}`)}},supGroupSign:async function(){C.info("----ã€åº”æ´å›¢ç­¾åˆ°ã€‘----");const t=await be();await Ot();let e=0;for(let n=0;n<t.length;){const i=t[n];try{const{data:t,code:n,message:a}=await Te(i.group_id,i.owner_uid);0===n?0===t.status?e++:C.info(a):C.warn(`[${i.group_name}]ç­¾åˆ°å¤±è´¥ ${a}`)}catch(t){C.error(`ç­¾åˆ°å¼‚å¸¸ ${t.message}`)}finally{await Ot()}}C.info(`ç­¾åˆ°ç»“æŸï¼ŒæˆåŠŸ${e}/${t.length}`)},liveSendMessage:async function(){C.info("----ã€å‘é€ç›´æ’­å¼¹å¹•ã€‘----");const t=await async function(){const{list:t,special_list:e}=await Oe();return t.push(...e),t}(),e=t.length;let n=0,i=0;C.info(`ä¸€å…±éœ€è¦å‘é€${e}ä¸ªç›´æ’­é—´`),C.verbose("æ‰€éœ€æ—¶é—´å¯èƒ½å¾ˆé•¿ï¼Œè¯·è€å¿ƒç­‰å¾…");for(let a=0;a<e;a++){const{room_info:s,anchor_info:o,medal:r}=t[a];null!=s&&s.room_id?100!==r.today_feed?(await Ee(s.room_id,o.nick_name)&&n++,a<e-1&&await Ot(O(1e4,25e3))):i++:(C.info(`ã€${o.nick_name}ã€‘æ²¡æœ‰ç›´æ’­é—´å“¦`),i++)}C.info(`æˆåŠŸå‘é€${n}ä¸ªå¼¹å¹•ï¼Œè·³è¿‡${i}ä¸ª`)},charging:async function(){if(C.info("----ã€ç»™ç›®æ ‡å……ç”µã€‘----"),await Ce(),await Ot(),function(){const t=S(),e=t.getDate(),n=b(t),i=Q.CHARGE_PRESET_TIME;return F.bCoinCouponBalance<2?(C.info(`å‰©ä½™åˆ¸ä¸º${F.bCoinCouponBalance}ï¼Œä¸è¶³2è·³è¿‡å……ç”µ`),!1):n===e?(C.info("ä»Šå¤©æ˜¯æœ€åä¸€å¤©äº†"),!0):!(i>e&&(C.info(`é¢„è®¾æ—¶é—´ä¸º${i}ï¼Œä¸ç¬¦åˆæ¡ä»¶`),1))}())try{const t=F.bCoinCouponBalance||0,e=Q.CHARGE_ID;let n=0;C.info(`b å¸åˆ¸ä½™é¢${t}`);const i=async()=>{const{code:n,message:i,data:a}=await async function(t=50,e=!0,n=Q.USERID,i="up",a=n){const{data:s}=await Gt.post("/x/ugcpay/web/v2/trade/elec/pay/quick",u.stringify({csrf:Q.BILIJCT,bp_num:t,is_bp_remains_prior:e,up_mid:n,otype:i,oid:a}));return s}(t,!0,e);0===n?(C.info(`ã€å……å€¼ç»“æœã€‘${xe[a.status]}`),a.status===xe["æˆåŠŸ"]&&(F.chargeOrderNo=a.order_no,await Ot(),await async function(){try{if(!F.chargeOrderNo)return!1;const t=Se[O(0,Se.length-1)],{code:e}=await async function(t,e="æ”¯æŒå¤§ä½¬ä¸€æ³¢"){const{data:n}=await Gt.post("/x/ugcpay/trade/elec/message",u.stringify({csrf:Q.BILIJCT,message:e,order_id:t}));return n}(F.chargeOrderNo,t);0===e&&C.info("ç•™è¨€æˆåŠŸï¼")}catch{}}())):C.warn(`å……ç”µå¤±è´¥ï¼š${n} ${i}`)};for(F.chargeOrderNo="";!(F.chargeOrderNo||(await i(),await Ot(),n++>2)););}catch(t){C.error(`å……ç”µå‡ºç°å¼‚å¸¸ï¼š${t.message}`)}},getVipPrivilege:async function(){C.info("----ã€é¢†å–å¤§ä¼šå‘˜æƒç›Šã€‘----"),function(){if(2!==F.vipType)return C.info("è´¦å·éå¹´åº¦å¤§ä¼šå‘˜ï¼Œä¸éœ€è¦é¢†å–æƒç›Š"),!1;const t=S(),e=t.getDate(),n=b(t);return 1===e||n===e||(C.info("ä»Šå¤©éé¢„è®¢é¢†å–æ—¶é—´ï¼Œè·³è¿‡é¢†å–"),!1)}()&&(await Ae(1),await Ae(2))},giveGift:async function(){C.info("----ã€æŠ•å–‚è¿‡æœŸé£Ÿç‰©ã€‘----");try{const t=await Le();if(await Ot(),null==t||!t.length)return void C.info("æ²¡æœ‰2å¤©å†…è¿‡æœŸçš„ç®€å•ç¤¼ç‰©");const{roomid:e,mid:n}=await async function(){const t=Object.assign([],Pe),e=()=>t.splice(O(Pe.length-1),1)[0];for(;t.length;){const t=e(),{roomid:n}=await Re(t);if(n)return{roomid:n,mid:t}}return await async function(){const{data:{count:t,items:e}}=await jt();if(await Ot(),!t)return{roomid:0,mid:0};const n=e[O(e.length-1)];return{mid:n.target_id,roomid:(null==n?void 0:n.roomid)||0}}()}();if(!e)return void C.info("æ²¡æœ‰æ‰¾åˆ°æŠ•å–‚ç›®æ ‡");await async function({roomid:t,mid:e},n){for(const i of n){await Ot();try{const{code:n,message:a,data:s}=await qt({roomid:t,ruid:e,bag_id:i.bag_id,gift_id:i.gift_id,gift_num:i.gift_num});0!==n?C.warn(`ç»™[ ${s.uname} ]æŠ•å–‚${s.gift_name}: ${a}`):C.info(`æˆåŠŸç»™[ ${s.uname} ]æŠ•å–‚${s.gift_num}${s.gift_name}`)}catch{}}}({roomid:e,mid:n},t)}catch(t){C.info(`æŠ•å–‚è¿‡æœŸé£Ÿç‰©å¼‚å¸¸ ${t}`)}},matchGame:async function(){if(C.info("----ã€èµ›äº‹ç¡¬å¸ç«çŒœã€‘----"),Me<=0)return void C.info("ç¡¬å¸æ•°é‡ä¸èƒ½å°äº 0");if(He())return;const t=await async function(){try{const{code:t,message:e,data:{list:n,page:i}}=await async function(t="",e=""){const{data:n}=await Gt.get(`/x/esports/guess/collection/question?pn=1&ps=50&gid=&sids=&stime=${t}&etime=${e}`);return n}();return 0!==t?void C.warn(`è·å–èµ›äº‹é”™è¯¯ ${t} ${e}`):0===i.total?(C.info("ä»Šæ—¥å·²ç»æ— æ³•è·å–èµ›äº‹"),null):n}catch(t){}}();if(await Ot(),!t)return;const e=await async function(t){let e=0;try{for(const n of t){const{contest:t,questions:i}=n,a=t.id,[{id:s,title:o,details:r,is_guess:c}]=i,[u,d]=r;if(He())return e;if(c)continue;C.info(`${o} <=> ${u.odds}:${d.odds}`);const f=u.odds>d.odds;let l;l=Ge>0?f?d:u:f?u:d,C.info(`é¢„æµ‹[ ${l.option} ] ${Me} é¢—ç¡¬å¸`),await Ot();const{code:p}=await De(a,s,l.detail_id,Me);0!==p?C.info("é¢„æµ‹å¤±è´¥"):(e++,F.money-=Me)}}catch(t){console.warn(t.message)}return e}(function(t,e){return t.filter((t=>{const{questions:n}=t,[{details:i,is_guess:a}]=n;if(a)return!1;const[s,o]=i;return Math.abs(s.odds-o.odds)>=e}))}(t,Q.MATCH_DIFF));C.info(`ã€ç«çŒœç»“æŸã€‘ä¸€å…±å‚ä¸${e}æ¬¡é¢„æµ‹`)}};async function je(t,...e){try{await async function(){C.info("----ã€ç™»å½•ã€‘----");try{const{data:t,message:e,code:n}=await ie();if(65006===n||-404===n)return void C.error(`ç™»å½•é”™è¯¯ ${n} ${e}`);if(0!==n)return void C.error(`ç™»å½•é”™è¯¯ ${n} ${e}`);if(!t.isLogin)throw new Error("æ¥å£è¿”å›ä¸ºæœªç™»å½•");await Ot(),await oe(t)}catch(t){throw new Error(t.message)}}()}catch(t){return C.error(`ç™»å½•å¤±è´¥: ${t}`),await It("ç™»å½•å¤±è´¥",E.value),"æœªå®Œæˆ"}const n=ne([...Object.values(Ke)]);for(const t of n)await t(),await Ot();return t&&await t(...e),await It("æ¯æ—¥å®Œæˆ",E.value),"å®Œæˆ"}!async function(){(function(){try{const t=h.readFileSync(p.resolve(__dirname,"../version.txt"),"utf8").trim();t&&C.info(`å½“å‰ç‰ˆæœ¬ã€${t}ã€‘`)}catch{}})(),Q.config.function.liveHeart?await je(Vt):await je()}();
