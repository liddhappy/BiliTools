"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("path"),e=require("pako"),n=require("fs"),i=require("querystring"),a=require("nodemailer"),s=require("got"),o=require("tough-cookie"),r=require("tunnel"),c=require("tencentcloud-sdk-nodejs"),u=require("crypto"),d=require("qs"),f=require("axios");function l(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}function g(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(n){if("default"!==n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}})),e.default=t,Object.freeze(e)}var p=g(t),h=g(e),m=g(n),_=g(i),y=g(a),w=g(s),v=g(o),$=g(r),T=g(u),S=l(f);function b(t){const e=t||E(),n=e.getFullYear(),i=e.getMonth()+1;return 2===i?n%4==0&&n%100!=0||n%400==0?29:28:[4,6,9,11].includes(i)?30:31}function E(){const t=new Date,e=t.getTime(),n=t.getTimezoneOffset()/60;return new Date(e+36e5*(n+8))}function I(t,e){return Math.ceil(e/t)}function O(t=6e4){t=t||6e4;const e=E().getTime()+t,n=new Date(e),i=n.getSeconds(),a=n.getMinutes(),s=n.getHours();return{value:`${i} ${a} ${s} * * * *`,string:`${s}:${a}:${i}`}}function C(t,e,n){if(n&&"boolean"!=typeof n&&(e=n=void 0),void 0===n&&("boolean"==typeof e?(n=e,e=void 0):"boolean"==typeof t&&(n=t,t=void 0)),void 0===t&&void 0===e?(t=0,e=1):void 0===e&&(e=t,t=0),t>e){const n=t;t=e,e=n}if(n||t%1||e%1){const n=Math.random();return Math.min(t+n*(e-t+parseFloat("1e-"+((n+"").length-1))),e)}return t+Math.floor(Math.random()*(e-t+1))}const N={value:""},x={log:A,error:function(t){A("error",t)},warn:function(t){A("warn",t)},info:function(t){A("info",t)},verbose:function(t){A("verbose",t)},debug:function(t){A("debug",t)}};function A(t,e){const n=E().toString().match(/\w{2}:\w{2}:\w{2}/)[0];if(function(t="debug"){const e=["error","warn","info","verbose","debug"],n=e.indexOf(t);return n>0?e.slice(0,n+1):e}().includes(t)){const t=`[${n}] ${e}`;N.value+=t+"\r\n"}console.log("[%s %s] %s",t,n,e)}const R=t=>{try{return Buffer.from(h.gzip(escape(t),{to:"string"}).toString(),"binary").toString("base64")}catch(t){return"Error: å½“å‰å­—ç¬¦ä¸²ä¸èƒ½è¢«GzipåŠ å¯†"}},k=t=>{try{const e=Buffer.from(t,"base64").toString("binary").split("").map((t=>t.charCodeAt(0))),n=h.inflate(new Uint8Array(e)),i=String.fromCharCode.apply(null,new Uint16Array(n));try{return unescape(i)}catch(t){return i}}catch(t){throw new Error("Error: å½“å‰å­—ç¬¦ä¸²ä¸èƒ½è¢«Gzipè§£å¯†")}},P=()=>"QingLong"===process.env.BARK_GROUP||"/ql"===process.env.QL_DIR;class D{static configFileName=function(){const t=P()?"cat_bili_config":"config",e=".json",{BILITOOLS_FILE_NAME:n}=process.env;return n?n.endsWith(e)?n:`${n}.json`:t+e}();static isQingLongPanel=P()}const L=t=>p.resolve(process.cwd(),t);function U(t){throw new Error(t||"é…ç½®æ–‡ä»¶ä¸å­˜ï¼ˆä½ç½®ä¸æ­£ç¡®ï¼‰åœ¨æˆ– cookie ä¸å­˜åœ¨ï¼ï¼ï¼")}const B=[()=>require(L("./config/config.dev.json")),()=>require(`./${D.configFileName}`),()=>require(L(`./config/${D.configFileName}`))],G=[()=>require("./config.json"),()=>require(L("./config/config.json"))];function M(t){const e=t.account.filter((t=>t.cookie));if(0===e.length)return;if(D.isQingLongPanel)return function(t){const e=process.argv.find((t=>t.includes("--item")||t.includes("-i")||t.includes("-I")));if(!e)return t[0];const n=Number(e.split("=")[1])-1;return!n||n>=t.length||n<0?(x.warn("ä¼¼ä¹æƒ³è¦æŒ‡å®šä¸€ä¸ªä¸å­˜åœ¨çš„ç”¨æˆ·ï¼Œæˆ‘ä»¬å°†æŒ‡å®šç¬¬ä¸€ä¸ªç”¨æˆ·"),t[0]):t[n]}(e);x.warn("åœ¨å•ç”¨æˆ·åœºæ™¯ä¸‹é…ç½®äº†å¤šç”¨æˆ·ï¼Œæˆ‘ä»¬å°†æ”¾å¼ƒå¤šä½™çš„é…ç½®");const n=e[0];return n.message=Object.assign(t.message||{},n.message),n}const H=function(){let t,e=!1;D.isQingLongPanel&&B.splice(0,1,...G);for(const n of B)try{if(t=n(),t)break;e=!0}catch(t){const{message:n={}}=t;n.includes&&n.includes("in JSON at position")&&(e=!0);continue}if(t||(t=(()=>{const{BILITOOLS_CONFIG:t,BILI_SCF_CONFIG:e,BILI_CONFIG:n}=process.env,i=t||e||n;if(i)try{return JSON.parse(k(i))}catch{U("ç¯å¢ƒä¸­çš„é…ç½®ä¸æ˜¯æœ‰æ•ˆçš„ JSON å­—ç¬¦ä¸²ï¼")}})()),t||(e&&U("é…ç½®æ–‡ä»¶å­˜åœ¨ï¼Œä½†æ˜¯æ— æ³•è§£æï¼å¯èƒ½ JSON æ ¼å¼ä¸æ­£ç¡®ï¼"),U()),t.account&&t.account.length){const e=M(t);if(e)return e}return t.cookie||U(),t}(),{cookie:K}=H;function q(t){return t?t.split("; ").map((t=>t.split("="))):[]}function j(t,e){return t?e&&0!==e.length?function(t){const e=Object.keys(t).reduce(((e,n)=>e+`${n}=${t[n]}; `),"");return e.substring(0,e.length-2||0)}(function(t,e){const n=q(null==e?void 0:e[0]).filter((t=>2===t.length)),i=q(t).concat(n).filter((t=>2===t.length)),a={};for(const t of i)a[t[0]]?a[t[0]]=t[1]:Object.defineProperty(a,t[0],{value:t[1],enumerable:!0,writable:!0});return a}(t,e)):t:""}function J(t,e){if(!t)return null;const n=`(?:^|)${e}=([^;]*)(?:;|$)`,i=t.match(n);return i?i[1]:null}function Y(){return J(K,"bili_jct")||""}function F(){return J(K,"LIVE_BUVID")||""}var Q,X,W,z,V,Z,tt,et;function nt(t){return null==t?void 0:t.map((t=>Number(t)))}class it{static config=H;static COOKIE=H.cookie;static BILIJCT=Y();static NICKNAME="";static USERID=function(){return Number(J(K,"DedeUserID"))||0}();static USER_AGENT=H.userAgent;static BILI_TARGET_COINS=null!==(Q=H.targetCoins)&&void 0!==Q?Q:5;static biliApiDelay=H.apiDelay||[2,6];static BILI_API_DELAY=Array.isArray(it.biliApiDelay)?it.biliApiDelay:[it.biliApiDelay];static BILI_CUSTOMIZE_UP=nt(H.customizeUp)||[];static BILI_GIFT_UP=nt(H.giftUp)||it.BILI_CUSTOMIZE_UP||[];static BILI_TARGET_LEVEL=null!==(X=H.targetLevel)&&void 0!==X?X:6;static BILI_STAY_COINS=null!==(W=H.stayCoins)&&void 0!==W?W:0;static BILI_UPPER_ACC_MATCH=H.upperAccMatch||!0;static BILI_COIN_RETRY_NUM=H.coinRetryNum||4;static CHARGE_ID=H.chargeUpId||it.USERID;static CHARGE_PRESET_TIME=H.chargePresetTime||31;static PUSHPLUS_TOKEN=process.env.PUSHPLUS_TOKEN||(null===(z=H.message)||void 0===z?void 0:z.pushplusToken);static MATCH_COINS=null!==(V=H.matchCoins)&&void 0!==V?V:5;static MATCH_SELECTION=null!==(Z=H.matchSelection)&&void 0!==Z?Z:1;static MATCH_DIFF=null!==(tt=H.matchDiff)&&void 0!==tt?tt:0;static MESSAGE_API=null===(et=H.message)||void 0===et?void 0:et.api}class at{static money=0;static coinsTask=it.BILI_TARGET_COINS;static share=!1;static watch=!1;static currentStartFun=0;static bCoinCouponBalance=0;static vipType=0}class st{static DAILY_TRIGGER_NAME="daily_bili_timer";static HEART_TRIGGER_NAME="heart_bili_timer";static DAILY_RUN_TIME="17:30:00-23:40:00";static HEART_RUN_TIME="12:00:00-20:00:00";static MS2DATE=864e5}!function(){var t;const e=(null===(t=it.config)||void 0===t?void 0:t.message)||{};it.PUSHPLUS_TOKEN&&(process.env.PUSH_PLUS_TOKEN=it.PUSHPLUS_TOKEN),["GOBOT_URL","GOBOT_TOKEN","GOBOT_QQ","SCKEY","QQ_SKEY","QQ_MODE","BARK_PUSH","BARK_SOUND","BARK_GROUP","TG_BOT_TOKEN","TG_USER_ID","TG_PROXY_AUTH","TG_PROXY_HOST","TG_PROXY_PORT","TG_API_HOST","DD_BOT_TOKEN","DD_BOT_SECRET","QYWX_KEY","QYWX_AM","IGOT_PUSH_KEY","PUSH_PLUS_TOKEN","PUSH_PLUS_USER"].forEach((t=>{const n=e[(i=t,i.toLowerCase().replace(/_(\w)/g,((t,e)=>e.toUpperCase())))]||e[t]||process.env[t];var i;n&&(process.env[t]=n)}))}();const ot=new function(t,e){return new class{constructor(t,e){this.name=t,this.data=null,this.dataFile="box.dat",this.logs=[],this.logSeparator="\n",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`ğŸ””${this.name}, å¼€å§‹!`)}isNode(){return"undefined"!=typeof module&&!!module.exports}isQuanX(){return"undefined"!=typeof $task}isSurge(){return"undefined"!=typeof $httpClient&&"undefined"==typeof $loon}isLoon(){return"undefined"!=typeof $loon}getScript(t){return new Promise((e=>{ot.get({url:t},((t,n,i)=>e(i)))}))}runScript(t,e){return new Promise((n=>{let i=this.getdata("@chavy_boxjs_userCfgs.httpapi");i=i?i.replace(/\n/g,"").trim():i;let a=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");a=a?1*a:20,a=e&&e.timeout?e.timeout:a;const[s,o]=i.split("@"),r={url:`http://${o}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:a},headers:{"X-Key":s,Accept:"*/*"}};ot.post(r,((t,e,i)=>n(i)))})).catch((t=>this.logErr(t)))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),n=this.fs.existsSync(t),i=!n&&this.fs.existsSync(e);if(!n&&!i)return{};{const i=n?t:e;try{return JSON.parse(this.fs.readFileSync(i))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),n=this.fs.existsSync(t),i=!n&&this.fs.existsSync(e),a=JSON.stringify(this.data);n?this.fs.writeFileSync(t,a):i?this.fs.writeFileSync(e,a):this.fs.writeFileSync(t,a)}}lodash_get(t,e,n){const i=e.replace(/\[(\d+)\]/g,".$1").split(".");let a=t;for(const t of i)if(a=Object(a)[t],void 0===a)return n;return a}lodash_set(t,e,n){return Object(t)!==t||(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce(((t,n,i)=>Object(t[n])===t[n]?t[n]:t[n]=Math.abs(e[i+1])>>0==+e[i+1]?[]:{}),t)[e[e.length-1]]=n),t}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,n,i]=/^@(.*?)\.(.*?)$/.exec(t),a=n?this.getval(n):"";if(a)try{const t=JSON.parse(a);e=t?this.lodash_get(t,i,""):e}catch(t){e=""}}return e}setdata(t,e){let n=!1;if(/^@/.test(e)){const[,i,a]=/^@(.*?)\.(.*?)$/.exec(e),s=this.getval(i),o=i?"null"===s?null:s||"{}":"{}";try{const e=JSON.parse(o);this.lodash_set(e,a,t),n=this.setval(JSON.stringify(e),i)}catch(e){const s={};this.lodash_set(s,a,t),n=this.setval(JSON.stringify(s),i)}}else n=ot.setval(t,e);return n}getval(t){return this.isSurge()||this.isLoon()?$persistentStore.read(t):this.isQuanX()?$prefs.valueForKey(t):this.isNode()?(this.data=this.loaddata(),this.data[t]):this.data&&this.data[t]||null}setval(t,e){return this.isSurge()||this.isLoon()?$persistentStore.write(t,e):this.isQuanX()?$prefs.setValueForKey(t,e):this.isNode()?(this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0):this.data&&this.data[e]||null}initGotEnv(t){this.got=this.got?this.got:w,this.cktough=this.cktough?this.cktough:v,this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}get(t,e=(()=>{})){t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"]),this.isSurge()||this.isLoon()?$httpClient.get(t,((t,n,i)=>{!t&&n&&(n.body=i,n.statusCode=n.status),e(t,n,i)})):this.isQuanX()?$task.fetch(t).then((t=>{const{statusCode:n,statusCode:i,headers:a,body:s}=t;e(null,{status:n,statusCode:i,headers:a,body:s},s)}),(t=>e(t))):this.isNode()&&(this.initGotEnv(t),this.got(t).on("redirect",((t,e)=>{try{const n=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();this.ckjar.setCookieSync(n,null),e.cookieJar=this.ckjar}catch(t){this.logErr(t)}})).then((t=>{const{statusCode:n,statusCode:i,headers:a,body:s}=t;e(null,{status:n,statusCode:i,headers:a,body:s},s)}),(t=>e(t))))}post(t,e=(()=>{})){if(t.body&&t.headers&&!t.headers["Content-Type"]&&(t.headers["Content-Type"]="application/x-www-form-urlencoded"),delete t.headers["Content-Length"],this.isSurge()||this.isLoon())$httpClient.post(t,((t,n,i)=>{!t&&n&&(n.body=i,n.statusCode=n.status),e(t,n,i)}));else if(this.isQuanX())t.method="POST",$task.fetch(t).then((t=>{const{statusCode:n,statusCode:i,headers:a,body:s}=t;e(null,{status:n,statusCode:i,headers:a,body:s},s)}),(t=>e(t)));else if(this.isNode()){this.initGotEnv(t);const{url:n,...i}=t;this.got.post(n,i).then((t=>{const{statusCode:n,statusCode:i,headers:a,body:s}=t;e(null,{status:n,statusCode:i,headers:a,body:s},s)}),(t=>e(t)))}}time(t){const e={"M+":(new Date).getMonth()+1,"d+":(new Date).getDate(),"H+":(new Date).getHours(),"m+":(new Date).getMinutes(),"s+":(new Date).getSeconds(),"q+":Math.floor(((new Date).getMonth()+3)/3),S:(new Date).getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,((new Date).getFullYear()+"").substr(4-RegExp.$1.length)));for(const n in e)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[n]:("00"+e[n]).substr((""+e[n]).length)));return t}msg(e=t,n="",i="",a){const s=t=>!t||!this.isLoon()&&this.isSurge()?t:"string"==typeof t?this.isLoon()?t:this.isQuanX()?{"open-url":t}:void 0:"object"==typeof t&&(t["open-url"]||t["media-url"])?this.isLoon()?t["open-url"]:this.isQuanX()?t:void 0:void 0;ot.isMute||(this.isSurge()||this.isLoon()?$notification.post(e,n,i,s(a)):this.isQuanX()&&$notify(e,n,i,s(a))),this.logs.push("","==============ğŸ“£ç³»ç»Ÿé€šçŸ¥ğŸ“£=============="),this.logs.push(e),n&&this.logs.push(n),i&&this.logs.push(i)}log(...t){t.length>0?this.logs=[...this.logs,...t]:x.info(this.logs.join(this.logSeparator))}logErr(t,e){!this.isSurge()&&!this.isQuanX()&&!this.isLoon()?ot.log("",`â—ï¸${this.name}, é”™è¯¯!`,t.stack):ot.log("",`â—ï¸${this.name}, é”™è¯¯!`,t)}wait(t){return new Promise((e=>setTimeout(e,t)))}done(t={}){const e=((new Date).getTime()-this.startTime)/1e3;this.log("",`ğŸ””${this.name}, ç»“æŸ! ğŸ•› ${e} ç§’`),this.log(),(this.isSurge()||this.isQuanX()||this.isLoon())&&$done(t)}}(t,e)};let rt="",ct="",ut="",dt="QingLong",ft="",lt="",gt="",pt="",ht="",mt="api.telegram.org",_t="",yt="",wt="",vt="",$t="",Tt="",St="";async function bt(t,e){var n;const i=null===(n=it.config.message)||void 0===n?void 0:n.email;if(!(i&&i.pass&&i.from&&i.host))return;const a=Number(i.port)||465,s=y.createTransport({host:i.host,port:a,secure:465===a,auth:{user:i.from,pass:i.pass}}),o=await s.sendMail({from:`${t} <${i.from}>`,to:i.to,subject:t,headers:{"Content-Type":"text/plain; charset=utf-8"},text:e});x.info(`é‚®ä»¶æ¶ˆæ¯å·²å‘é€: ${o.messageId}`)}async function Et(t,e){try{const n=it.MESSAGE_API;if(!n)return;const i=n.replace("{title}",t).replace("{text}",e);await ot.get(i)}catch(t){}}function It(t,e,n=2100){return new Promise((i=>{if(rt){e=e.replace(/[\n\r]/g,"\n\n");const a={url:rt.includes("SCT")?`https://sctapi.ftqq.com/${rt}.send`:`https://sc.ftqq.com/${rt}.send`,body:`text=${t}&desp=${e}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};setTimeout((()=>{ot.post(a,((t,e,n)=>{try{t?(x.info("å‘é€é€šçŸ¥è°ƒç”¨APIå¤±è´¥ï¼ï¼\n"),x.info(t)):0===(n=JSON.parse(n)).errno||0===n.data.errno?x.info("serveré…±å‘é€é€šçŸ¥æ¶ˆæ¯æˆåŠŸğŸ‰\n"):1024===n.errno?x.info(`serveré…±å‘é€é€šçŸ¥æ¶ˆæ¯å¼‚å¸¸: ${n.errmsg}\n`):x.info(`serveré…±å‘é€é€šçŸ¥æ¶ˆæ¯å¼‚å¸¸\n${JSON.stringify(n)}`)}catch(t){ot.logErr(t,e)}finally{i(n)}}))}),n)}else i("")}))}function Ot(t,e,n={}){return new Promise((i=>{if(ct){const a={url:`${ct}/${encodeURIComponent(t)}/${encodeURIComponent(e)}?sound=${ut}&group=${dt}&${_.stringify(n)}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};ot.get(a,((t,e,n)=>{try{t?(x.info("Bark APPå‘é€é€šçŸ¥è°ƒç”¨APIå¤±è´¥ï¼ï¼\n"),x.info(t)):200===(n=JSON.parse(n)).code?x.info("Bark APPå‘é€é€šçŸ¥æ¶ˆæ¯æˆåŠŸğŸ‰\n"):x.info(`${n.message}\n`)}catch(t){ot.logErr(t,e)}finally{i("")}}))}else i("")}))}function Ct(t,e){return new Promise((n=>{if(ft&&lt){const i={url:`https://${mt}/bot${ft}/sendMessage`,body:`chat_id=${lt}&text=${t}\n\n${e}&disable_web_page_preview=true`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};if(gt&&pt){const t={https:$.httpsOverHttp({proxy:{host:gt,port:+pt,proxyAuth:ht}})};Object.assign(i,{agent:t})}ot.post(i,((t,e,i)=>{try{t?(x.info("telegramå‘é€é€šçŸ¥æ¶ˆæ¯å¤±è´¥ï¼ï¼\n"),x.info(t)):(i=JSON.parse(i)).ok?x.info("Telegramå‘é€é€šçŸ¥æ¶ˆæ¯æˆåŠŸğŸ‰ã€‚\n"):400===i.error_code?x.info("è¯·ä¸»åŠ¨ç»™botå‘é€ä¸€æ¡æ¶ˆæ¯å¹¶æ£€æŸ¥æ¥æ”¶ç”¨æˆ·IDæ˜¯å¦æ­£ç¡®ã€‚\n"):401===i.error_code&&x.info("Telegram bot token å¡«å†™é”™è¯¯ã€‚\n")}catch(t){ot.logErr(t,e)}finally{n(i)}}))}else n("")}))}function Nt(t,e){return new Promise((n=>{const i={url:`https://oapi.dingtalk.com/robot/send?access_token=${_t}`,json:{msgtype:"text",text:{content:` ${t}\n\n${e}`}},headers:{"Content-Type":"application/json"},timeout:15e3};if(_t&&yt){const t=require("crypto"),e=Date.now(),a=t.createHmac("sha256",yt);a.update(`${e}\n${yt}`);const s=encodeURIComponent(a.digest("base64"));i.url=`${i.url}&timestamp=${e}&sign=${s}`,ot.post(i,((t,e,i)=>{try{t?(x.info("é’‰é’‰å‘é€é€šçŸ¥æ¶ˆæ¯å¤±è´¥ï¼ï¼\n"),x.info(t)):0===(i=JSON.parse(i)).errcode?x.info("é’‰é’‰å‘é€é€šçŸ¥æ¶ˆæ¯æˆåŠŸğŸ‰ã€‚\n"):x.info(`${i.errmsg}\n`)}catch(t){ot.logErr(t,e)}finally{n(i)}}))}else _t?ot.post(i,((t,e,i)=>{try{t?(x.info("é’‰é’‰å‘é€é€šçŸ¥æ¶ˆæ¯å¤±è´¥ï¼ï¼\n"),x.info(t)):0===(i=JSON.parse(i)).errcode?x.info("é’‰é’‰å‘é€é€šçŸ¥æ¶ˆæ¯å®Œæˆã€‚\n"):x.info(`${i.errmsg}\n`)}catch(t){ot.logErr(t,e)}finally{n(i)}})):n("")}))}function xt(t,e){return new Promise((n=>{const i={url:`https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=${wt}`,json:{msgtype:"text",text:{content:` ${t}\n\n${e}`}},headers:{"Content-Type":"application/json"},timeout:15e3};wt?ot.post(i,((t,e,i)=>{try{t?(x.info("ä¼ä¸šå¾®ä¿¡å‘é€é€šçŸ¥æ¶ˆæ¯å¤±è´¥ï¼ï¼\n"),x.info(t)):0===(i=JSON.parse(i)).errcode?x.info("ä¼ä¸šå¾®ä¿¡å‘é€é€šçŸ¥æ¶ˆæ¯æˆåŠŸğŸ‰ã€‚\n"):x.info(`${i.errmsg}\n`)}catch(t){ot.logErr(t,e)}finally{n(i)}})):n("")}))}function At(t){const e=vt.split(",");if(e[2]){const n=e[2].split("|");let i="";for(let e=0;e<n.length;e++){const a="ç­¾åˆ°å· "+(e+1);t.match(a)&&(i=n[e])}return i||(i=e[2]),i}return"@all"}function Rt(t,e){return new Promise((n=>{if(vt){const i=vt.split(","),a={url:"https://qyapi.weixin.qq.com/cgi-bin/gettoken",json:{corpid:`${i[0]}`,corpsecret:`${i[1]}`},headers:{"Content-Type":"application/json"},timeout:15e3};ot.post(a,((a,s,o)=>{const r=e.replace(/\n/g,"<br/>"),c=JSON.parse(o).access_token;let u;switch(i[4]){case"0":u={msgtype:"textcard",textcard:{title:`${t}`,description:`${e}`,url:"https://github.com/whyour/qinglong",btntxt:"æ›´å¤š"}};break;case"1":u={msgtype:"text",text:{content:`${t}\n\n${e}`}};break;default:u={msgtype:"mpnews",mpnews:{articles:[{title:`${t}`,thumb_media_id:`${i[4]}`,author:"æ™ºèƒ½åŠ©æ‰‹",content_source_url:"",content:`${r}`,digest:`${e}`}]}}}i[4]||(u={msgtype:"text",text:{content:`${t}\n\n${e}`}}),u={url:`https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=${c}`,json:{touser:`${At(e)}`,agentid:`${i[3]}`,safe:"0",...u},headers:{"Content-Type":"application/json"}},ot.post(u,((t,i,a)=>{try{t?(x.info("æˆå‘˜ID:"+At(e)+"ä¼ä¸šå¾®ä¿¡åº”ç”¨æ¶ˆæ¯å‘é€é€šçŸ¥æ¶ˆæ¯å¤±è´¥ï¼ï¼\n"),x.info(t)):0===(a=JSON.parse(a)).errcode?x.info("æˆå‘˜ID:"+At(e)+"ä¼ä¸šå¾®ä¿¡åº”ç”¨æ¶ˆæ¯å‘é€é€šçŸ¥æ¶ˆæ¯æˆåŠŸğŸ‰ã€‚\n"):x.info(`${a.errmsg}\n`)}catch(t){ot.logErr(t,i)}finally{n(a)}}))}))}else n("")}))}function kt(t,e,n={}){return new Promise((i=>{if($t){if(!new RegExp("^[a-zA-Z0-9]{24}$").test($t))return x.info("æ‚¨æ‰€æä¾›çš„IGOT_PUSH_KEYæ— æ•ˆ\n"),void i("");const a={url:`https://push.hellyw.com/${$t.toLowerCase()}`,body:`title=${t}&content=${e}&${_.stringify(n)}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};ot.post(a,((t,e,n)=>{try{t?(x.info("å‘é€é€šçŸ¥è°ƒç”¨APIå¤±è´¥ï¼ï¼\n"),x.info(t)):("string"==typeof n&&(n=JSON.parse(n)),0===n.ret?x.info("iGotå‘é€é€šçŸ¥æ¶ˆæ¯æˆåŠŸğŸ‰\n"):x.info(`iGotå‘é€é€šçŸ¥æ¶ˆæ¯å¤±è´¥ï¼š${n.errMsg}\n`))}catch(t){ot.logErr(t,e)}finally{i(n)}}))}else i("")}))}function Pt(t,e){return new Promise((n=>{if(Tt){e=e.replace(/[\n\r]/g,"<br>");const i={token:`${Tt}`,title:`${t}`,content:`${e}`,topic:`${St}`},a={url:"https://www.pushplus.plus/send",body:JSON.stringify(i),headers:{"Content-Type":" application/json"},timeout:15e3};ot.post(a,((t,e,i)=>{try{t?(x.info(`push+å‘é€${St?"ä¸€å¯¹å¤š":"ä¸€å¯¹ä¸€"}é€šçŸ¥æ¶ˆæ¯å¤±è´¥ï¼ï¼\n`),x.info(t)):200===(i=JSON.parse(i)).code?x.info(`push+å‘é€${St?"ä¸€å¯¹å¤š":"ä¸€å¯¹ä¸€"}é€šçŸ¥æ¶ˆæ¯å®Œæˆã€‚\n`):x.info(`push+å‘é€${St?"ä¸€å¯¹å¤š":"ä¸€å¯¹ä¸€"}é€šçŸ¥æ¶ˆæ¯å¤±è´¥ï¼š${i.msg}\n`)}catch(t){ot.logErr(t,e)}finally{n(i)}}))}else n("")}))}function Dt(){try{const t=m.readFileSync(p.resolve(__dirname,"../version.txt"),"utf8").trim();t&&x.info(`å½“å‰ç‰ˆæœ¬ã€${t}ã€‘`)}catch{}}async function Lt(t,e){x.info("----ã€æ¶ˆæ¯æ¨é€ã€‘----"),t=`Bili-${it.NICKNAME}-${t}`,await async function(t,e,n={},i="\n\næœ¬é€šçŸ¥ Byï¼šhttps://github.com/catlair/BiliTools"){e+=i,await Promise.all([It(t,e),Pt(t,e)]),await Promise.all([Ot(t,e,n),Ct(t,e),Nt(t,e),xt(t,e),Rt(t,e),kt(t,e,n),bt(t,e),Et(t,e)])}(t,e,void 0,"")}function Ut(t){const e=it.BILI_API_DELAY;let n;n=1===e.length?1e3*e[0]:1e3*C(e[0]||2,e[1]||6),n=t||n;const i=(new Date).getTime()+parseInt(n,10);for(;(new Date).getTime()<i;);return new Promise((t=>{t("done")}))}process.env.PUSH_KEY&&(rt=process.env.PUSH_KEY),process.env.QQ_SKEY&&process.env.QQ_SKEY,process.env.QQ_MODE&&process.env.QQ_MODE,process.env.BARK_PUSH?(ct=process.env.BARK_PUSH.indexOf("https")>-1||process.env.BARK_PUSH.indexOf("http")>-1?process.env.BARK_PUSH:`https://api.day.app/${process.env.BARK_PUSH}`,process.env.BARK_SOUND&&(ut=process.env.BARK_SOUND),process.env.BARK_GROUP&&(dt=process.env.BARK_GROUP)):ct&&-1===ct.indexOf("https")&&-1===ct.indexOf("http")&&(ct=`https://api.day.app/${ct}`),process.env.TG_BOT_TOKEN&&(ft=process.env.TG_BOT_TOKEN),process.env.TG_USER_ID&&(lt=process.env.TG_USER_ID),process.env.TG_PROXY_AUTH&&(ht=process.env.TG_PROXY_AUTH),process.env.TG_PROXY_HOST&&(gt=process.env.TG_PROXY_HOST),process.env.TG_PROXY_PORT&&(pt=process.env.TG_PROXY_PORT),process.env.TG_API_HOST&&(mt=process.env.TG_API_HOST),process.env.DD_BOT_TOKEN&&(_t=process.env.DD_BOT_TOKEN,process.env.DD_BOT_SECRET&&(yt=process.env.DD_BOT_SECRET)),process.env.QYWX_KEY&&(wt=process.env.QYWX_KEY),process.env.QYWX_AM&&(vt=process.env.QYWX_AM),process.env.IGOT_PUSH_KEY&&($t=process.env.IGOT_PUSH_KEY),process.env.PUSH_PLUS_TOKEN&&(Tt=process.env.PUSH_PLUS_TOKEN),process.env.PUSH_PLUS_USER&&(St=process.env.PUSH_PLUS_USER);const Bt=c.scf.v20180416.Client,{DAILY_RUN_TIME:Gt,DAILY_TRIGGER_NAME:Mt}=st;async function Ht(t=Mt,e,n,i=2){var a;if(!H.sls)return!1;const s=null===(a=H.sls)||void 0===a?void 0:a.name,o={credential:{secretId:process.env.TENCENT_SECRET_ID,secretKey:process.env.TENCENT_SECRET_KEY},region:H.sls.region,profile:{httpProfile:{endpoint:"scf.tencentcloudapi.com"}}},r=new Bt(o);async function c(){const i=n||function(t=Gt){var e,n;const i=t.split("-"),a=i[0].split(":").map((t=>+t)),s=i[1].split(":").map((t=>+t)),o=C(null!==(e=a[0])&&void 0!==e?e:19,null!==(n=s[0])&&void 0!==n?n:23);let r=0;r=o==a[0]?C(a[1],59):o==s[0]?C(s[1]):C(59);let c=0;return c=o==a[0]?C(a[2],59):o==s[0]?C(s[2]):C(59),{value:`${c} ${r} ${o} * * * *`,string:`${o}:${r}:${c}`}}(H.dailyRunTime),a={FunctionName:s,TriggerName:t,Type:"timer",TriggerDesc:i.value,Qualifier:"$DEFAULT"},o=await async function(t){try{const{Triggers:e}=await r.ListTriggers({FunctionName:s});return-1!==(null==e?void 0:e.findIndex((e=>e.TriggerName===t)))}catch({code:t,message:e}){return x.error(`è·å–triggerå¤±è´¥ ${t} => ${e}`),!1}}(t);if(x.info(`ä¿®æ”¹æ—¶é—´ä¸ºï¼š${i.string}`),o){const t=await async function(t){try{return await r.DeleteTrigger(t)}catch({code:t,message:e}){return x.warn(`åˆ é™¤triggerå¤±è´¥ ${t} => ${e}`),!1}}(a);if(!t)return}return!!await async function(t){const n=E();t.CustomArgument=JSON.stringify({...e,lastTime:n.getDate().toString()});try{return await r.CreateTrigger(t)}catch({code:t,message:e}){return x.error(`åˆ›å»ºtriggerå¤±è´¥ ${t} => ${e}`),!1}}(a)}if(!process.env.TENCENT_SECRET_ID||!process.env.TENCENT_SECRET_KEY)return x.info("ç¯å¢ƒå˜é‡ä¸å­˜åœ¨TENCENT_SECRET_IDå’ŒTENCENT_SECRET_KEY"),!1;let u=!1;for(;!u&&i;)u=await c(),i--;return u}const Kt={"User-Agent":it.USER_AGENT||"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36 Edg/96.0.1054.62","content-type":"application/x-www-form-urlencoded","accept-language":"accept-language: zh-CN,zh;q=0.9,en-GB;q=0.8,en;q=0.7"};var qt;S.default.defaults.headers.common.Cookie=it.COOKIE,S.default.defaults.withCredentials=!0,S.default.defaults.headers.common["User-Agent"]=Kt["User-Agent"],S.default.defaults.headers.post["content-type"]=Kt["content-type"],S.default.defaults.headers.common["accept-language"]=Kt["accept-language"],function(t){t[t["åº”ç”¨ç¨‹åºä¸å­˜åœ¨æˆ–å·²è¢«å°ç¦"]=-1]="åº”ç”¨ç¨‹åºä¸å­˜åœ¨æˆ–å·²è¢«å°ç¦",t[t["Access Keyé”™è¯¯"]=-2]="Access Keyé”™è¯¯",t[t["APIæ ¡éªŒå¯†åŒ™é”™è¯¯"]=-3]="APIæ ¡éªŒå¯†åŒ™é”™è¯¯",t[t["è°ƒç”¨æ–¹å¯¹è¯¥Methodæ²¡æœ‰æƒé™"]=-4]="è°ƒç”¨æ–¹å¯¹è¯¥Methodæ²¡æœ‰æƒé™",t[t["è´¦å·æœªç™»å½•"]=-101]="è´¦å·æœªç™»å½•",t[t["è´¦å·è¢«å°åœ"]=-102]="è´¦å·è¢«å°åœ",t[t["ç§¯åˆ†ä¸è¶³"]=-103]="ç§¯åˆ†ä¸è¶³",t[t["ç¡¬å¸ä¸è¶³"]=-104]="ç¡¬å¸ä¸è¶³",t[t["éªŒè¯ç é”™è¯¯"]=-105]="éªŒè¯ç é”™è¯¯",t[t["è´¦å·éæ­£å¼ä¼šå‘˜æˆ–åœ¨é€‚åº”æœŸ"]=-106]="è´¦å·éæ­£å¼ä¼šå‘˜æˆ–åœ¨é€‚åº”æœŸ",t[t["åº”ç”¨ä¸å­˜åœ¨æˆ–è€…è¢«å°ç¦"]=-107]="åº”ç”¨ä¸å­˜åœ¨æˆ–è€…è¢«å°ç¦",t[t["æœªç»‘å®šæ‰‹æœº?"]=-108]="æœªç»‘å®šæ‰‹æœº?",t[t["æœªç»‘å®šæ‰‹æœº"]=-110]="æœªç»‘å®šæ‰‹æœº",t[t["csrf æ ¡éªŒå¤±è´¥"]=-111]="csrf æ ¡éªŒå¤±è´¥",t[t["ç³»ç»Ÿå‡çº§ä¸­"]=-112]="ç³»ç»Ÿå‡çº§ä¸­",t[t["è´¦å·å°šæœªå®åè®¤è¯"]=-113]="è´¦å·å°šæœªå®åè®¤è¯",t[t["è¯·å…ˆç»‘å®šæ‰‹æœº"]=-114]="è¯·å…ˆç»‘å®šæ‰‹æœº",t[t["è¯·å…ˆå®Œæˆå®åè®¤è¯"]=-115]="è¯·å…ˆå®Œæˆå®åè®¤è¯"}(qt||(qt={}));const jt="https://account.bilibili.com",Jt="https://live.bilibili.com",Yt="https://www.bilibili.com/",Ft="https://account.bilibili.com",Qt="https://api.live.bilibili.com",Xt="https://api.bilibili.com",Wt="https://manga.bilibili.com",zt="https://api.vc.bilibili.com";S.default.interceptors.response.use((t=>{var e,n;const i=(null===(e=t.headers)||void 0===e?void 0:e["set-cookie"])||[];it.COOKIE=j(it.COOKIE,i);const a=null===(n=t.data)||void 0===n?void 0:n.code;switch(a){case qt["è´¦å·æœªç™»å½•"]:case qt["è´¦å·è¢«å°åœ"]:(async()=>{x.error(`è¿è¡Œç»“æŸï¼š${qt[a]}`),await Lt(`å¼‚å¸¸ï¼š${qt[a]}`,N.value),process.exit(0)})();break;default:return t}}),(t=>function(t){const e=t.config;if(0===e.retry)return Promise.reject(t);e.retry||(e.retry=2);if(e.__retryCount=e.__retryCount||0,e.__retryCount>=e.retry)return Promise.reject(t);e.__retryCount+=1;return new Promise((function(t){setTimeout((function(){t(void 0)}),e.retryDelay||100)})).then((function(){return S.default(e)}))}(t)));const Vt=S.default.create({baseURL:Ft}),Zt=S.default.create({baseURL:Qt,headers:{Referer:Yt}}),te=S.default.create({baseURL:Xt,headers:{Referer:Yt}}),ee=S.default.create({baseURL:Wt}),ne=S.default.create({baseURL:zt});async function ie(t=3394945){const e=(new Date).getTime(),{data:n}=await Zt.get(`/xlive/web-room/v1/gift/bag_list?t=${e}&room_id=${t}`);return n}async function ae(t=1,e=10){t>10&&(t=10);const{data:n}=await Zt.get(`/xlive/app-ucenter/v1/user/GetMyMedals?page=${t}&page_size=${e}`);return n}async function se({ruid:t,gift_num:e,bag_id:n,gift_id:i,roomid:a}){const s=it.BILIJCT,o=s,r=d.stringify({gift_id:i,ruid:t,gift_num:e,bag_id:n,biz_id:a,rnd:(new Date).getTime(),send_ruid:0,storm_beat_id:0,metadata:"",price:0,visit_id:"",csrf:s,platform:"pc",biz_code:"Live",csrf_token:o,uid:it.USERID}),{data:c}=await Zt.post("/xlive/revenue/v2/gift/sendBag",r,{headers:{Origin:Jt}});return c}function oe(t,e,n,i,a){const s=Y(),o=s,r=[F(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))];return{ua:it.USER_AGENT,id:[n,e,a,t],csrf_token:s,csrf:o,device:r,uname:i}}async function re(){try{await async function(){const{data:t}=await S.default.get("https://api.live.bilibili.com/relation/v1/Feed/heartBeat");return t}()}catch{}}async function ce(t){const{data:{area_id:e,parent_area_id:n,room_id:i}}=await async function(t){const{data:e}=await Zt.get(`/room/v1/Room/get_info?room_id=${t}&from=room`);return e}(t);return{room_id:i,area_id:e,parent_area_id:n}}async function ue(t,e){const n={id:JSON.stringify(t.id),device:JSON.stringify(t.device),ts:(new Date).getTime(),is_patch:0,heart_beat:"[]",ua:t.ua,visit_id:"",csrf:t.csrf,csrf_token:t.csrf_token};try{const{data:i,code:a}=await async function(t){const{data:e}=await S.default.post("https://live-trace.bilibili.com/xlive/data-interface/v1/x25Kn/E",d.stringify(t));return e}(n);if(0===a)return x.info(`è¿›å…¥ã€${t.uname}ã€‘çš„ç›´æ’­é—´`),e.v++,i}catch(t){x.verbose(t)}}async function de(t,e,n){if(n.v>6)return;const i={id:JSON.stringify(e.id),device:JSON.stringify(e.device),ets:t.timestamp,benchmark:t.secret_key,time:60,ts:(new Date).getTime(),ua:e.ua},a=function(t,e){const[n,i,a,s]=JSON.parse(t.id),[o,r]=JSON.parse(t.device),{ets:c,time:u,ts:d}=t,f={platform:"web",parent_id:n,area_id:i,seq_id:a,room_id:s,buvid:o,uuid:r,ets:c,time:u,ts:d},l=t.benchmark,g=["MD5","SHA1","SHA256","SHA224","SHA512","SHA384"];let p=JSON.stringify(f);for(const t of e)p=T.createHmac(g[t],l).update(p).digest("hex");return p}(i,t.secret_rule);try{const{data:t,code:s,message:o}=await async function(t){const{data:e}=await S.default.post("https://live-trace.bilibili.com/xlive/data-interface/v1/x25Kn/X",d.stringify(t));return e}(Object.assign({visit_id:"",csrf:e.csrf,csrf_token:e.csrf_token,s:a},i));return 0===s?(x.info(`å‘ã€${e.uname}ã€‘å‘é€ç¬¬${n.v}æ¬¡å¿ƒè·³`),n.v++):x.warn(`å‘ã€${e.uname}ã€‘å‘é€ç¬¬${n.v}æ¬¡å¿ƒè·³å¤±è´¥ ${s} ${o}`),t}catch(t){x.verbose(t)}}async function fe(t=1,e=10){try{const{code:n,message:i,data:a}=await ae(t,e);return 0!==n?(x.verbose(`è·å–ç›´æ’­é—´å¤±è´¥ ${n} ${i}`),null):a}catch(t){return x.verbose(`è·å–ç›´æ’­é—´å¼‚å¸¸ ${t.message}`),null}}async function le(t=!0){const e=await async function(){let t=0;try{var e,n;const{data:i,code:a}=await ie();return 0!==a||(null===(e=i.list)||void 0===e?void 0:e.length)<=0?24:(null===(n=i.list)||void 0===n||n.forEach((e=>{if(30607===e.gift_id){const n=(1e3*e.expire_at-(new Date).getTime())/st.MS2DATE;n>6&&n<=7&&(t+=e.gift_num)}})),t>=24?0:24-t)}catch(t){}return 24}();let n;return t?n=await async function(){const{items:t,page_info:e}=await fe();let{total_page:n}=e;if(n&&n>1){n=n>3?3:n;for(let e=2;e<=n;e++){const n=await fe(e,10);t.push(...n.items)}}return t}():({items:n}=await fe()),{fansMedalList:n,heartNum:e}}async function ge(t){var e;let n,i;if(t){const{d:e,hn:a}=JSON.parse(t);n="string"==typeof e?JSON.parse(k(e)):e,i=a}else n=[{seq:{v:0}}],i={v:0};let a=0;if(null!==(e=n[0])&&void 0!==e&&e.seq.v){!function(t){const e=F(),n=Y(),i=it.USER_AGENT;t.forEach((t=>{t.baseData.ua=i,t.baseData.csrf=t.baseData.csrf_token=n,t.baseData.device[0]=e,t.baseData.id[2]=t.seq.v}))}(n);for(const t of n)if(await re(),t.data&&(t.data=await de(t.data,t.baseData,t.seq)),await Ut(1e3),a++,t.seq.v>5&&(t.seq.v=0,a>=i.v))return x.info("ä»Šæ—¥è·å–å°å¿ƒå¿ƒå®Œæˆ"),0;if(n.find((t=>t.seq.v>5)))return 1}else{n.length=0;const{heartNum:t,fansMedalList:e}=await le();i.v=t;for(const t of e){if(0===i.v)return x.info("ä»Šæ—¥è·å–å°æ˜Ÿæ˜Ÿå·²ç»è¾¾åˆ° 24"),0;if(a>=i.v)break;const{roomid:e,uname:s}=t,{room_id:o,area_id:r,parent_area_id:c}=await ce(e),u={v:0},d=oe(o,r,c,s,u.v);await re(),await Ut(500);const f=await ue(d,u);n.push({data:f,baseData:d,seq:u}),a++}}return function(t){t.forEach((t=>{delete t.baseData.csrf,delete t.baseData.csrf_token,delete t.baseData.ua,t.baseData.device[0]=0}))}(n),{d:R(JSON.stringify(n)),hn:i,l:n.length}}const pe={silver2Coin:!0,liveSignTask:!0,addCoins:!0,mangaSign:!1,shareAndWatch:!0,supGroupSign:!1,liveSendMessage:!1,taskReward:!0,charging:!1,getVipPrivilege:!1,giveGift:!1,matchGame:!1};function he(t){return function(){for(const t in pe)if(Object.prototype.hasOwnProperty.call(pe,t)){const e=pe[t];switch((it.config.function||{})[t]){case!0:!1===e&&(pe[t]=!0);break;case!1:!0===e&&(pe[t]=!1)}}pe.addCoins||pe.shareAndWatch||(pe.taskReward=!1)}(),t.map((t=>pe[t.name]?t:null)).filter((t=>t))}async function me(){const{data:t}=await te.get("/x/web-interface/nav",{retry:3,headers:{Origin:jt}});return t}async function _e(){const{data:t}=await te.get("/x/web-interface/coin/today/exp");return t}function ye(t){const e=t.level_info,n=e.current_level;if(n>=it.BILI_TARGET_LEVEL&&(at.coinsTask=0),x.info(`å½“å‰ç­‰çº§: ${e.current_level}`),n>=6)pe.shareAndWatch=!1,pe.addCoins=!1,x.info("å·²ç»æ»¡çº§ï¼Œä¸éœ€è¦å†æŠ•å¸äº†ï¼Œåšä¸ªç™½å«–æ€ªå§");else{const t=e.next_exp-e.current_exp;x.info(`è·ç¦»å‡çº§è¿˜éœ€è¦ ${t} ç»éªŒï¼Œé¢„è®¡ ${function(t){if(it.BILI_TARGET_COINS<=0)return t/15;const e=10*it.BILI_TARGET_COINS+15,n=t/e,i=at.money/(it.BILI_TARGET_COINS-1);return n<i?Math.floor(n):(t-i*e)/25+i}(t).toFixed(2)} å¤©`)}}async function we(t){try{var e;const{data:n}=await async function(){const{data:t}=await Vt.get("/site/getCoin");return t}();x.info(`ç™»å½•æˆåŠŸ: ${t.uname}`),x.info(`ç¡¬å¸ä½™é¢: ${n.money||0}`),it.NICKNAME=function(t){const e=t.length;return e<=3?t:`${t[0]}**${t[e-1]}`}(t.uname),at.money=n.money||0,at.bCoinCouponBalance=(null===(e=t.wallet)||void 0===e?void 0:e.coupon_balance)||0,ye(t),function(t){let e="";switch(at.vipType=t.vipType,t.vipType){case 0:e="æ— å¤§ä¼šå‘˜";break;case 1:e="æœˆåº¦å¤§ä¼šå‘˜";break;case 2:e="å¹´åº¦å¤§ä¼šå‘˜"}0===t.vipStatus&&(e="æ— å¤§ä¼šå‘˜"===e?e:e+"[å·²è¿‡æœŸ]"),x.info(`å¤§ä¼šå‘˜çŠ¶æ€: ${e}`)}(t)}catch(t){x.error(`è·å–ç¡¬å¸ä¿¡æ¯å¼‚å¸¸: ${t.message}`)}}async function ve(t,e=12,n=1){try{const{data:i}=await te.get("/x/space/article",{params:{callback:"__test",jsonp:"jsonp",sort:"publish_time",pn:n,ps:e,mid:t}});return function(t){const e=t.replace(/^\w+\(/,"").replace(/\)$/,"");return JSON.parse(e)}(i)}catch(t){console.log(t)}}async function $e(t,e,n=1){const{data:i}=await te.post("/x/web-interface/coin/add",d.stringify({aid:t,multiply:e,selectLike:n,csrf:it.BILIJCT}));return i}async function Te(t,e=1){const{data:n}=await S.default.post("https://www.bilibili.com/audio/music-service-c/web/coin/add",d.stringify({sid:t,multiply:e,csrf:it.BILIJCT}));return n}const Se="video",be="audio",Ee="article";async function Ie(t=!0){try{const e=it.USERID;let n;n=t?await async function(t=1,e=50){const{data:n}=await te.get("/x/relation/tag",{params:{tagid:-10,pn:t,ps:e}});return n}():await async function(t,e=1,n=50,i="desc",a="attention"){const{data:s}=await te.get("/x/relation/followings",{params:{vmid:t,pn:e,ps:n,order:i,order_type:a}});return s}(e);const{data:i,message:a,code:s}=n;if(0===s&&i.length>0){await Ut();const{mid:t}=i[C(i.length-1)];return await Ne(t)}return 0===i.length?{msg:"-1",data:{}}:{msg:t?`æœªè·å–åˆ°ç‰¹åˆ«å…³æ³¨åˆ—è¡¨: ${s}-${a}`:`æœªè·å–åˆ°å…³æ³¨åˆ—è¡¨: ${s}-${a}`,data:{}}}catch(t){return{msg:t.message,data:{}}}}async function Oe(){const t=[1,3,4,5,160,22,119],e=t[C(t.length-1)];try{const{data:t,message:n,code:i}=await async function(t=1,e=3){const{data:n}=await te.get("/x/web-interface/ranking/region",{params:{rid:t,day:e}});return n}(e,3);if(0==i){const{aid:e,title:n,author:i}=t[C(t.length-1)];return{msg:"0",data:{id:Number(e),title:n,author:i}}}return{msg:`æœªè·å–åˆ°æ’è¡Œä¿¡æ¯: ${i}-${n}`,data:{}}}catch(t){return{msg:t.message,data:{}}}}async function Ce(){const t=it.BILI_CUSTOMIZE_UP;if(0===t.length)return{msg:"-1",data:{}};const e=t[C(t.length-1)];return await Ne(e)}async function Ne(t){try{const{code:e,data:n,message:i}=await async function(t){const{data:e}=await te.get(`/x/space/navnum?mid=${t}`);return e}(t);if(e)return{msg:`é€šè¿‡uidè·å–è§†é¢‘å¤±è´¥: ${e}-${i}`,data:{}};await Ut();const{video:a,audio:s,article:o}=n,{type:r,page:c,index:u}=function([t,e,n]){const i=t+e+n;if(!i)return;const a=C(0,i-1);let s=a;if(a<t)return{type:Se,page:I(30,s+1),index:s%30};const o=t+e;return s=a-t,a<o?{type:be,page:I(30,s+1),index:s%30}:(s=a-o,{type:Ee,page:I(12,s+1),index:s%12})}([a,s,o]),d={[Se]:xe,[be]:Ae,[Ee]:Re},f=await d[r](t,c,u);return f.message?{msg:f.message,data:{}}:{msg:"0",data:f}}catch(t){return x.debug(t),{msg:t.message,data:{}}}}async function xe(t,e,n){const{code:i,data:a,message:s}=await async function(t,e=30,n=1,i=""){const{data:a}=await te.get("/x/space/arc/search",{params:{jsonp:"jsonp",order:"pubdate",keyword:i,pn:n,tid:0,ps:e,mid:t}});return a}(t,30,e);if(i)return{message:s};const{aid:o,title:r,author:c}=a.list.vlist[n];return{type:Se,id:o,title:r,author:c}}async function Ae(t,e,n){const{code:i,data:a,msg:s}=await async function(t,e=30,n=1){const{data:i}=await te.get("/audio/music-service/web/song/upper",{params:{jsonp:"jsonp",order:1,pn:n,ps:e,uid:t}});return i}(t,30,e);if(i)return{message:s};const{data:o}=a,{id:r,uname:c,title:u}=o[n];return{type:be,id:r,title:u,author:c}}async function Re(t,e,n){const{code:i,data:a,message:s}=await ve(t,12,e);if(i)return{message:s};const{articles:o}=a,{id:r,title:c,author:{name:u}}=o[n];return{type:Ee,id:r,title:c,author:u,mid:t}}async function ke(){let t;const e=[Ce,Ie,()=>Ie(!1),Oe];it.BILI_CUSTOMIZE_UP||e.shift(),e.splice(0,at.currentStartFun);for(let i=0;i<e.length;i++){var n;const a=e[i];if(t=await a(),"0"===t.msg)return t;let s=Number(null!==(n=it.BILI_COIN_RETRY_NUM)&&void 0!==n?n:4);for(s=s<1?1:s>8?8:s;s--;)if(await Ut(),t=await a(),"-1"===t.msg&&(s=0),"0"===t.msg)return t;s<=0&&(at.currentStartFun=i)}return{msg:"-1",data:{id:0}}}async function Pe({id:t,coin:e=1,type:n="video",mid:i}){const a={[Se]:$e,[be]:Te,[Ee]:(t,e=1)=>async function(t,e,n=1){const{data:i}=await te.post("/x/web-interface/coin/add",d.stringify({aid:e,upid:t,avtype:2,multiply:n,csrf:it.BILIJCT}));return i}(i,t,e)},s=await a[n](Number(t),e);return{code:s.code,message:s.message||s.msg}}async function De(t,e){const{data:n}=await ne.get("/link_setting/v1/link_setting/sign_in",{params:{group_id:t,owner_id:e}});return n}async function Le(){try{const{data:t,code:e,message:n}=await async function(){const{data:t}=await ne.get("/link_group/v1/member/my_groups");return t}();return 0===e?(null==t?void 0:t.list)||[]:(x.warn(`è·å–è‡ªå·±çš„åº”æ´å›¢å¼‚å¸¸å¤±è´¥: ${n}`),[])}catch(t){x.error(`è·å–è‡ªå·±çš„åº”æ´å›¢å¼‚å¸¸: ${t}`)}}const Ue=["æ£’","æ£’å”‰","æ£’è€¶","åŠ æ²¹~","UPåŠ æ²¹!","æ”¯æŒ~","æ”¯æŒæ”¯æŒï¼","å‚¬æ›´å•¦","é¡¶é¡¶","ç•™ä¸‹è„šå°~","å¹²æ¯","bilibiliå¹²æ¯","o(*ï¿£â–½ï¿£*)o","(ï½¡ï½¥âˆ€ï½¥)ï¾‰ï¾å—¨","(â—Ë‡âˆ€Ë‡â—)","( â€¢Ì€ Ï‰ â€¢Ì )y","(à¸‡ â€¢_â€¢)à¸‡",">.<","^_~"],Be=["(âŒ’â–½âŒ’)","ï¼ˆï¿£â–½ï¿£ï¼‰","(=ãƒ»Ï‰ãƒ»=)","(ï½€ãƒ»Ï‰ãƒ»Â´)","(ã€œï¿£â–³ï¿£)ã€œ","(ï½¥âˆ€ï½¥)","(Â°âˆ€Â°)ï¾‰","(ï¿£3ï¿£)","â•®(ï¿£â–½ï¿£)â•­","_(:3ã€âˆ )_","( Â´_ã‚ï½€)","â†_â†","â†’_â†’","(<_<)","(>_>)","(;Â¬_Â¬)","(ï¾ŸĞ”ï¾Ÿâ‰¡ï¾ŸĞ´ï¾Ÿ)!?","Î£(ï¾ŸĞ´ï¾Ÿ;)","Î£( ï¿£â–¡ï¿£||)","(Â´ï¼›Ï‰ï¼›`)","ï¼ˆ/TĞ”T)/","(^ãƒ»Ï‰ãƒ»^ )","(ï½¡ï½¥Ï‰ï½¥ï½¡)","(â—ï¿£(ï½´)ï¿£â—)","Îµ=Îµ=(ãƒâ‰§âˆ‡â‰¦)ãƒ","(Â´ï½¥_ï½¥`)","(-_-#)","ï¼ˆï¿£ã¸ï¿£ï¼‰","(ï¿£Îµ(#ï¿£) Î£","ãƒ½(`Ğ”Â´)ï¾‰","ï¼ˆ#-_-)â”¯â”â”¯","(â•¯Â°å£Â°)â•¯(â”´â€”â”´","â†â—¡â†","( â™¥Ğ´â™¥)","Î£>â€•(ã€ƒÂ°Ï‰Â°ã€ƒ)â™¡â†’","â„(â„ â„â€¢â„Ï‰â„â€¢â„ â„)â„","(â•¬ï¾ŸĞ´ï¾Ÿ)â–„ï¸»â”»â”³â•ä¸€","ï½¥*ï½¥:â‰¡(ã€€Îµ:)","(æ±—)","(è‹¦ç¬‘)"].concat("1","2","3","4","5","6","7","8","9","ç­¾åˆ°","å“ˆå“ˆ");async function Ge(){try{const{code:t,message:e,data:n}=await async function(t=1,e=256,n=1){const{data:i}=await Zt.get(`/xlive/app-ucenter/v1/fansMedal/panel?page=${t}&page_size=${e}&target_id=${n}`);return i}(1,256,it.USERID);return 0!==t?(x.verbose(`è·å–å‹‹ç« ä¿¡æ¯å¤±è´¥ ${t} ${e}`),null):n}catch(t){return x.error(`è·å–å‹‹ç« å¼‚å¸¸ ${t.message}`),null}}async function Me(t,e){const n=Be[C(Be.length-1)];try{const{code:i,message:a}=await async function(t,e){const n=it.BILIJCT,i=n;e||(e=C(10).toString());const{data:a}=await Zt.post("/msg/send",d.stringify({color:5566168,fontsize:25,mode:1,msg:e,rnd:Date.now(),roomid:t,bubble:0,csrf:n,csrf_token:i}));return a}(t,n);return 0===i||(11e3===i?(x.warn(`ã€${e}ã€‘${t}-å¯èƒ½æœªå¼€å¯è¯„è®º`),!1):(x.warn(`ã€${e}ã€‘${t}-å‘é€å¤±è´¥ ${a}`),x.verbose(`code: ${i}`),!1))}catch(t){x.verbose(`å‘é€å¼¹å¹•å¼‚å¸¸ ${t.message}`)}}async function He(){try{const{data:t,message:e,code:n}=await me();if(0!==n)return void x.warn(`è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥ï¼š${n} ${e}`);!function(t){var e;at.bCoinCouponBalance=(null===(e=t.wallet)||void 0===e?void 0:e.coupon_balance)||0}(t)}catch(t){x.error(`è·å–ç”¨æˆ·ä¿¡æ¯å¼‚å¸¸ï¼š${t.message}`)}}var Ke;async function qe(t){try{const e=function(t){switch(t){case 1:return"B å¸åˆ¸";case 2:return"å¤§ä¼šå‘˜ä¼˜æƒ åˆ¸";default:return""}}(t),{code:n,message:i}=await async function(t=1){const{data:e}=await te.post("/x/vip/privilege/receive",d.stringify({csrf:it.BILIJCT,type:t}));return e}(t);let a="æˆåŠŸ";return 0===n&&(a=`å¤±è´¥ ${i}`),x.info(`é¢†å–${e} ${a}`),!0}catch(t){x.error(`é¢†å–æƒç›Šå‡ºç°å¼‚å¸¸ï¼š${t.message}`)}return!1}async function je(t){let e=0,n=!1;for(;!(n||(n=await qe(t),e>2));)e++;return n}!function(t){t[t["æˆåŠŸ"]=4]="æˆåŠŸ",t[t["ä½äº20ç”µæ± "]=-2]="ä½äº20ç”µæ± ",t[t["Bå¸ä¸è¶³"]=-4]="Bå¸ä¸è¶³"}(Ke||(Ke={}));const{BILI_GIFT_UP:Je}=it;let Ye=0;async function Fe(){try{const{data:{list:t}}=await ie();return t.filter((t=>!![1,30607].includes(t.gift_id)&&(1e3*t.expire_at-(new Date).getTime())/st.MS2DATE<2))}catch(t){if(Ye)return null;await Fe(),Ye++}}async function Qe(t){try{const{data:{live_room:e}}=await async function(t){const{data:e}=await te.get(`/x/space/acc/info?mid=${t}&jsonp=jsonp`);return e}(t);if(await Ut(),e.roomStatus)return{roomid:e.roomid}}catch{}return{roomid:0}}const Xe=it.BILIJCT,We=Xe;async function ze(t,e,n,i){const a=d.stringify({is_fav:0,main_id:e,oid:t,detail_id:n,count:i,csrf:Xe,csrf_token:We}),{data:s}=await te.post("/x/esports/guess/add",a);return s}const{MATCH_SELECTION:Ve,MATCH_COINS:Ze}=it;function tn(){return at.money-Ze<it.BILI_TARGET_COINS&&(x.info(`éœ€è¦ä¿ç•™${it.BILI_TARGET_COINS}ä¸ªç¡¬å¸ï¼Œä»»åŠ¡ç»“æŸ`),!0)}var en={taskReward:async function(){x.info("----ã€æ¯æ—¥ä»»åŠ¡å®Œæˆæƒ…å†µã€‘----");try{const{data:t,message:e,code:n}=await async function(){const{data:t}=await te.get("/x/member/web/exp/reward");return t}();await Ut();const{data:i}=await _e();if(0!=n)return void x.warn(`çŠ¶æ€è·å–å¤±è´¥: ${n} ${e}`);const a=at.money-it.BILI_STAY_COINS;let s=0;0===at.coinsTask?x.info(`ä»Šæ—¥æŠ•å¸è·å–ç»éªŒ: ${i}ï¼Œè¿˜éœ€æŠ•å¸0é¢—ï¼Œç»éªŒå¤Ÿäº†ï¼Œä¸æƒ³æŠ•äº†`):a<=0?x.info(`ä»Šæ—¥æŠ•å¸è·å–ç»éªŒ: ${i}ï¼Œè¿˜éœ€æŠ•å¸0é¢—ï¼Œç¡¬å¸ä¸å¤Ÿäº†ï¼Œä¸æŠ•å¸äº†`):a<at.coinsTask?(s=at.coinsTask-a,x.info(`æŠ•å¸è·å–ç»éªŒ: ${i}ï¼Œè¿˜éœ€æŠ•å¸æ•°é‡: ${s}é¢—;(ç›®æ ‡${at.coinsTask}é¢—ï¼Œå¿½ç•¥éƒ¨åˆ†æŠ•å¸)`)):(s=at.coinsTask-i/10,x.info(`æŠ•å¸è·å–ç»éªŒ: ${i}ï¼Œè¿˜éœ€æŠ•å¸æ•°é‡: ${s}é¢—;(ç›®æ ‡${at.coinsTask}é¢—)`)),at.coinsTask=s,x.info("æ¯æ—¥åˆ†äº«: "+(t.share?"å·²å®Œæˆ":"[æœªå®Œæˆ]")),x.info("æ¯æ—¥æ’­æ”¾: "+(t.watch?"å·²å®Œæˆ":"[æœªå®Œæˆ]")),at.share=t.share,at.watch=t.watch}catch(t){x.error(`çŠ¶æ€è·å–å¼‚å¸¸ ${t.message}`)}},liveSignTask:async function(){x.info("----ã€ç›´æ’­ç­¾åˆ°ã€‘----");try{const{data:t}=await async function(){const{data:t}=await Zt.get("/xlive/web-ucenter/v1/sign/WebGetSignInfo");return t}();if(1===t.status)return x.info("å·²ç­¾åˆ°ï¼Œè·³è¿‡ç­¾åˆ°"),void x.info(`å·²ç»ç­¾åˆ°${t.hadSignDays}å¤©ï¼Œ${t.specialText}`)}catch(t){}try{const{code:t,data:e,message:n}=await async function(){const{data:t}=await Zt.get("/xlive/web-ucenter/v1/sign/DoSign");return t}();0===t?x.info(`ç›´æ’­ç­¾åˆ°æˆåŠŸ: ${e.text}ï¼Œç‰¹åˆ«ä¿¡æ¯: ${e.specialText}ï¼Œæœ¬æœˆç­¾åˆ°å¤©æ•°: ${e.hadSignDays}å¤©;`):x.warn(`ç›´æ’­ç­¾åˆ°å¤±è´¥: ${t} ${n}`)}catch(t){x.error(`ç›´æ’­ç­¾åˆ°å¼‚å¸¸: ${t.message}`)}},shareAndWatch:async function(){if(x.info("----ã€åˆ†äº«/æ’­æ”¾è§†é¢‘ã€‘----"),at.share&&at.watch)return void x.info("å·²å®Œæˆï¼Œè·³è¿‡åˆ†äº«/æ’­æ”¾");let t=0;try{let e=await Ce();if("-1"===e.msg&&(e=await Oe()),"0"!==e.msg)return x.warn(`è·å–è§†é¢‘å¤±è´¥ ${e.msg}`),!1;{const{id:n,author:i,title:a}=e.data;t=n,x.info(`è·å–è§†é¢‘: ${a} --upã€${i}ã€‘`)}}catch(t){return x.error(`è·å–è§†é¢‘å‡ºç°å¼‚å¸¸: ${t.message}`),!1}if(!at.share){await Ut();try{const{code:e,message:n}=await async function(t){const e={csrf:it.BILIJCT,aid:t},{data:n}=await te.post("/x/web-interface/share/add",d.stringify(e));return n}(t);0===e?x.info("åˆ†äº«è§†é¢‘æˆåŠŸ!"):x.warn(`åˆ†äº«è§†é¢‘å¤±è´¥: ${e} ${n}`)}catch(t){x.error(`åˆ†äº«è§†é¢‘å¼‚å¸¸: ${t.message}`)}}if(!at.watch){await Ut();try{const{code:e,message:n}=await async function(t,e){const{data:n}=await te.post("/x/click-interface/web/heartbeat",d.stringify({aid:t,played_time:e}));return n}(t,C(4,60));0===e?x.info("æ’­æ”¾è§†é¢‘æˆåŠŸ!"):x.warn(`æ’­æ”¾è§†é¢‘å¤±è´¥: ${e} ${n}`)}catch(t){x.error(`æ’­æ”¾è§†é¢‘å¼‚å¸¸: ${t.message}`)}}},silver2Coin:async function(){x.info("----ã€é“¶ç“œå­å…‘æ¢ç¡¬å¸ã€‘----");try{const{data:t,code:e,message:n}=await async function(){const{data:t}=await Zt.get("/xlive/revenue/v1/wallet/getStatus");return t}();if(0!=e&&x.info(`è·å–ç“œå­è¯¦æƒ…å¤±è´¥ ${n}`),0===t.silver_2_coin_left)x.info("ä»Šæ—¥å·²å…‘æ¢ä¸€æ¬¡");else if(t.silver<700)x.info("å…‘æ¢å¤±è´¥ï¼Œä½ ç“œå­ä¸å¤Ÿäº†");else{const{message:t}=await async function(){const{data:t}=await Zt.post("/xlive/revenue/v1/wallet/silver2coin",d.stringify({csrf_token:it.BILIJCT,csrf:it.BILIJCT}));return t}();x.info(t),await async function(){const{data:t}=await Zt.get("/xlive/revenue/v1/wallet/myWallet?need_bp=1&need_metal=1&platform=pc");return t}()}}catch(t){x.error(`æ“ä½œå¼‚å¸¸ ${t.message}`)}},addCoins:async function(){if(x.info("----ã€è§†é¢‘æŠ•å¸ã€‘----"),!at.coinsTask)return void x.info("è·³è¿‡æŠ•å¸ï¼Œä»Šæ—¥å·²å®Œæˆ");let t,e=0,n=0;for(;at.coinsTask&&n<5;){try{const{data:t,code:e}=await _e();if(0==e){const e=it.BILI_TARGET_COINS-t/10;at.coinsTask=e>0?e:0}}catch(t){}if(at.coinsTask<=0||at.money<=0)break;const{data:i,msg:a}=await ke();if(null==i||!i.id||"0"!=a){n++;continue}await Ut();const{id:s,title:o,author:r,type:c,mid:u}=i;try{const i=await Pe({id:s,type:c,mid:u});if(0===i.code)at.money--,at.coinsTask--,e++,x.info(`ç»™[${o}--upã€${r}ã€‘]æŠ•å¸æˆåŠŸ`);else{if(n++,-111===i.code||-104===i.code){x.warn(`${s} ${i.message} æ— æ³•ç»§ç»­è¿›è¡ŒæŠ•å¸`);break}if(x.warn(`ç»™upæŠ•å¸å¤±è´¥ ${i.code} ${i.message}`),t===i.code)break;t=i.code}}catch(t){n++,x.error(`æŠ•å¸å¼‚å¸¸ ${t.message}`)}finally{await Ut(1500)}}n>=5&&x.info("å‡ºç°å¼‚å¸¸/é”™è¯¯5æ¬¡ï¼Œè‡ªåŠ¨é€€å‡ºæŠ•å¸"),x.info(`ä¸€å…±æˆåŠŸæŠ•å¸${e}é¢—`),x.info(`ç¡¬å¸è¿˜å‰©${at.money}é¢—`)},mangaSign:async function(){x.info("----ã€æ¼«ç”»ç­¾åˆ°ã€‘----");try{const{code:t}=await async function(t="android"){const{data:e}=await ee.post("/twirp/activity.v1.Activity/ClockIn",d.stringify({platform:t}));return e}();0==t?x.info("æ¼«ç”»ç­¾åˆ°æˆåŠŸ"):x.warn("æ¼«ç”»ç­¾åˆ°å¤±è´¥")}catch(t){400===t.response.status?x.info("å·²ç»ç­¾åˆ°è¿‡äº†ï¼Œè·³è¿‡ä»»åŠ¡"):x.error(`æ¼«ç”»ç­¾åˆ°å¼‚å¸¸ ${t.message}`)}},supGroupSign:async function(){x.info("----ã€åº”æ´å›¢ç­¾åˆ°ã€‘----");const t=await Le();await Ut();let e=0;for(let n=0;n<t.length;){const i=t[n];try{const{data:t,code:n,message:a}=await De(i.group_id,i.owner_uid);0===n?0===t.status?e++:x.info(a):x.warn(`[${i.group_name}]ç­¾åˆ°å¤±è´¥ ${a}`)}catch(t){x.error(`ç­¾åˆ°å¼‚å¸¸ ${t.message}`)}finally{await Ut()}}x.info(`ç­¾åˆ°ç»“æŸï¼ŒæˆåŠŸ${e}/${t.length}`)},liveSendMessage:async function(){x.info("----ã€å‘é€ç›´æ’­å¼¹å¹•ã€‘----");const t=await async function(){const{list:t,special_list:e}=await Ge();return t.push(...e),t}(),e=t.length;let n=0,i=0;x.info(`ä¸€å…±éœ€è¦å‘é€${e}ä¸ªç›´æ’­é—´`),x.verbose("æ‰€éœ€æ—¶é—´å¯èƒ½å¾ˆé•¿ï¼Œè¯·è€å¿ƒç­‰å¾…");for(let a=0;a<e;a++){const{room_info:s,anchor_info:o,medal:r}=t[a];null!=s&&s.room_id?100!==r.today_feed?(await Me(s.room_id,o.nick_name)&&n++,a<e-1&&await Ut(C(1e4,25e3))):i++:(x.info(`ã€${o.nick_name}ã€‘æ²¡æœ‰ç›´æ’­é—´å“¦`),i++)}x.info(`æˆåŠŸå‘é€${n}ä¸ªå¼¹å¹•ï¼Œè·³è¿‡${i}ä¸ª`)},charging:async function(){if(x.info("----ã€ç»™ç›®æ ‡å……ç”µã€‘----"),await He(),await Ut(),function(){const t=E(),e=t.getDate(),n=b(t),i=it.CHARGE_PRESET_TIME;return at.bCoinCouponBalance<2?(x.info(`å‰©ä½™åˆ¸ä¸º${at.bCoinCouponBalance}ï¼Œä¸è¶³2è·³è¿‡å……ç”µ`),!1):n===e?(x.info("ä»Šå¤©æ˜¯æœ€åä¸€å¤©äº†"),!0):!(i>e&&(x.info(`é¢„è®¾æ—¶é—´ä¸º${i}ï¼Œä¸ç¬¦åˆæ¡ä»¶`),1))}())try{const t=at.bCoinCouponBalance||0,e=it.CHARGE_ID;let n=0;x.info(`b å¸åˆ¸ä½™é¢${t}`);const i=async()=>{const{code:n,message:i,data:a}=await async function(t=50,e=!0,n=it.USERID,i="up",a=n){const{data:s}=await te.post("/x/ugcpay/web/v2/trade/elec/pay/quick",d.stringify({csrf:it.BILIJCT,bp_num:t,is_bp_remains_prior:e,up_mid:n,otype:i,oid:a}));return s}(t,!0,e);0===n?(x.info(`ã€å……å€¼ç»“æœã€‘${Ke[a.status]}`),a.status===Ke["æˆåŠŸ"]&&(at.chargeOrderNo=a.order_no,await Ut(),await async function(){try{if(!at.chargeOrderNo)return!1;const t=Ue[C(0,Ue.length-1)],{code:e}=await async function(t,e="æ”¯æŒå¤§ä½¬ä¸€æ³¢"){const{data:n}=await te.post("/x/ugcpay/trade/elec/message",d.stringify({csrf:it.BILIJCT,message:e,order_id:t}));return n}(at.chargeOrderNo,t);0===e&&x.info("ç•™è¨€æˆåŠŸï¼")}catch{}}())):x.warn(`å……ç”µå¤±è´¥ï¼š${n} ${i}`)};for(at.chargeOrderNo="";!(at.chargeOrderNo||(await i(),await Ut(),n++>2)););}catch(t){x.error(`å……ç”µå‡ºç°å¼‚å¸¸ï¼š${t.message}`)}},getVipPrivilege:async function(){x.info("----ã€é¢†å–å¤§ä¼šå‘˜æƒç›Šã€‘----"),function(){if(2!==at.vipType)return x.info("è´¦å·éå¹´åº¦å¤§ä¼šå‘˜ï¼Œä¸éœ€è¦é¢†å–æƒç›Š"),!1;const t=E(),e=t.getDate(),n=b(t);return 1===e||n===e||(x.info("ä»Šå¤©éé¢„è®¢é¢†å–æ—¶é—´ï¼Œè·³è¿‡é¢†å–"),!1)}()&&(await je(1),await je(2))},giveGift:async function(){x.info("----ã€æŠ•å–‚è¿‡æœŸé£Ÿç‰©ã€‘----");try{const t=await Fe();if(await Ut(),null==t||!t.length)return void x.info("æ²¡æœ‰2å¤©å†…è¿‡æœŸçš„ç®€å•ç¤¼ç‰©");const{roomid:e,mid:n}=await async function(){const t=Object.assign([],Je),e=()=>t.splice(C(Je.length-1),1)[0];for(;t.length;){const t=e(),{roomid:n}=await Qe(t);if(n)return{roomid:n,mid:t}}return await async function(){const{data:{count:t,items:e}}=await ae();if(await Ut(),!t)return{roomid:0,mid:0};const n=e[C(e.length-1)];return{mid:n.target_id,roomid:(null==n?void 0:n.roomid)||0}}()}();if(!e)return void x.info("æ²¡æœ‰æ‰¾åˆ°æŠ•å–‚ç›®æ ‡");await async function({roomid:t,mid:e},n){for(const i of n){await Ut();try{const{code:n,message:a,data:s}=await se({roomid:t,ruid:e,bag_id:i.bag_id,gift_id:i.gift_id,gift_num:i.gift_num});0!==n?x.warn(`ç»™[ ${s.uname} ]æŠ•å–‚${s.gift_name}: ${a}`):x.info(`æˆåŠŸç»™[ ${s.uname} ]æŠ•å–‚${s.gift_num}${s.gift_name}`)}catch{}}}({roomid:e,mid:n},t)}catch(t){x.info(`æŠ•å–‚è¿‡æœŸé£Ÿç‰©å¼‚å¸¸ ${t}`)}},matchGame:async function(){if(x.info("----ã€èµ›äº‹ç¡¬å¸ç«çŒœã€‘----"),Ze<=0)return void x.info("ç¡¬å¸æ•°é‡ä¸èƒ½å°äº 0");if(tn())return;const t=await async function(){try{const{code:t,message:e,data:{list:n,page:i}}=await async function(t="",e=""){const{data:n}=await te.get(`/x/esports/guess/collection/question?pn=1&ps=50&gid=&sids=&stime=${t}&etime=${e}`);return n}();return 0!==t?void x.warn(`è·å–èµ›äº‹é”™è¯¯ ${t} ${e}`):0===i.total?(x.info("ä»Šæ—¥å·²ç»æ— æ³•è·å–èµ›äº‹"),null):n}catch(t){}}();if(await Ut(),!t)return;const e=await async function(t){let e=0;try{for(const n of t){const{contest:t,questions:i}=n,a=t.id,[{id:s,title:o,details:r,is_guess:c}]=i,[u,d]=r;if(tn())return e;if(c)continue;x.info(`${o} <=> ${u.odds}:${d.odds}`);const f=u.odds>d.odds;let l;l=Ve>0?f?d:u:f?u:d,x.info(`é¢„æµ‹[ ${l.option} ] ${Ze} é¢—ç¡¬å¸`),await Ut();const{code:g}=await ze(a,s,l.detail_id,Ze);0!==g?x.info("é¢„æµ‹å¤±è´¥"):(e++,at.money-=Ze)}}catch(t){console.warn(t.message)}return e}(function(t,e){return t.filter((t=>{const{questions:n}=t,[{details:i,is_guess:a}]=n;if(a)return!1;const[s,o]=i;return Math.abs(s.odds-o.odds)>=e}))}(t,it.MATCH_DIFF));x.info(`ã€ç«çŒœç»“æŸã€‘ä¸€å…±å‚ä¸${e}æ¬¡é¢„æµ‹`)}};async function nn(t,...e){try{await async function(){x.info("----ã€ç™»å½•ã€‘----");try{const{data:t,message:e,code:n}=await me();if(65006===n||-404===n)return void x.error(`ç™»å½•é”™è¯¯ ${n} ${e}`);if(0!==n)return void x.error(`ç™»å½•é”™è¯¯ ${n} ${e}`);if(!t.isLogin)throw new Error("æ¥å£è¿”å›ä¸ºæœªç™»å½•");await Ut(),await we(t)}catch(t){throw new Error(t.message)}}()}catch(t){return x.error(`ç™»å½•å¤±è´¥: ${t}`),await Lt("ç™»å½•å¤±è´¥",N.value),"æœªå®Œæˆ"}const n=he([...Object.values(en)]);for(const t of n)await t(),await Ut();return t&&await t(...e),await Lt("æ¯æ—¥å®Œæˆ",N.value),"å®Œæˆ"}exports.main_handler=function(t){return t.TriggerName===st.HEART_TRIGGER_NAME?async function(t){let e;Dt();try{e=JSON.parse(t.Message)}catch(t){}if(e&&!e.d&&e.lastTime===E().getDate().toString())return"ä»Šæ—¥é‡å¤æ‰§è¡Œ";const n=await ge(t.Message);return 0===n?(await Ht(st.HEART_TRIGGER_NAME),"ä»Šæ—¥å®Œæˆ"):1===n?(await Ht(st.HEART_TRIGGER_NAME,{hn:{v:0},d:[{seq:{v:0}}]},O(5e3)),"ç­‰å¾…ç»§ç»­ä¸‹ä¸€è½®"):(await Ht(st.HEART_TRIGGER_NAME,n,O(62e3-1e3*n.l)),"ç­‰å¾…ç»§ç»­ä¸‹æ¬¡å¿ƒè·³")}(t):async function(t){let e;Dt();try{e=JSON.parse(t.Message)}catch(t){}return e&&e.lastTime===E().getDate().toString()?"ä»Šæ—¥é‡å¤æ‰§è¡Œ":await nn(Ht)}(t)};
